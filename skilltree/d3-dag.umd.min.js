!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("fs"),require("child_process")):"function"==typeof define&&define.amd?define(["exports","fs","child_process"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).d3=t.d3||{},t.require$$1,t.require$$2)}(this,(function(t,e,r){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=n(e),o=n(r);class s{constructor(t){this.base=t}[Symbol.iterator](){return this.base[Symbol.iterator]()}concat(...t){return a(function*(t){for(const e of t)yield*e}([this,...t.map(a)]))}entries(){return a(function*(t){let e=0;for(const r of t)yield[e++,r]}(this))}every(t){return!this.some(((e,r)=>!t(e,r)))}fill(t){return this.map((()=>t))}filter(t){return a(function*(e){for(const[r,n]of e)t(n,r)&&(yield n)}(this.entries()))}find(t){for(const[e,r]of this.entries())if(t(r,e))return r}findIndex(t){for(const[e,r]of this.entries())if(t(r,e))return e;return-1}flatMap(t){return a(function*(e){for(const[r,n]of e)yield*a(t(n,r))}(this.entries()))}forEach(t){for(const[e,r]of this.entries())t(r,e)}includes(t,e=0){return this.indexOf(t,e)>=0}indexOf(t,e=0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");for(const[r,n]of this.entries())if(r>=e&&n===t)return r;return-1}join(t=","){return[...this].join(t)}keys(){return a(function*(t){let e=0;for(const r of t)yield e++}(this))}lastIndexOf(t,e=1/0){if(e<0)throw new Error("fromIndex doesn't support negative numbers because generator length isn't known");let r=-1;for(const[n,i]of this.entries())n<=e&&i===t&&(r=n);return r}get length(){return this.reduce((t=>t+1),0)}map(t){return a(function*(e){for(const[r,n]of e)yield t(n,r)}(this.entries()))}reduce(t,e){if(void 0===e){const e=t;let r,n=!0;for(const[t,i]of this.entries())n?(r=i,n=!1):r=e(r,i,t);if(n)throw new TypeError("Reduce of empty iterable with no initial value");return r}{const r=t;let n=e;for(const[t,e]of this.entries())n=r(n,e,t);return n}}reverse(){return a([...this].reverse())}slice(t=0,e=1/0){return a(function*(r){for(const[n,i]of r)if(n<t);else{if(!(n<e))break;yield i}}(this.entries()))}some(t){for(const[e,r]of this.entries())if(t(r,e))return!0;return!1}sort(t){return a([...this].sort(t))}splice(t,e=0,...r){return a(function*(n){for(const[i,o]of n)i===t&&(yield*r),(i<t||i>=t+e)&&(yield o)}(this.entries()))}values(){return this}}function a(t){return function(t){return"function"==typeof t[Symbol.iterator]}(t)?new s(t):new s({[Symbol.iterator]:()=>t})}function h(t){if(void 0!==t)return t;throw new Error("got unexpected undefined value")}function c(t,e){e.size<t.size&&([e,t]=[t,e]);for(const r of t)if(e.has(r))return!0;return!1}class l extends Map{getThrow(t){const e=this.get(t);if(void 0===e)throw new Error(`map doesn't contain key: ${t}`);return e}getDefault(t,e){const r=this.get(t);return void 0===r?e:r}setIfAbsent(t,e){const r=this.get(t);return void 0===r?(this.set(t,e),e):r}}class u{constructor(t,e,r=[]){this.child=t,this.data=e,this.points=r}}class f{constructor(t,e,r,n){this.source=t,this.target=e,this.data=r,this.points=n}}class d{constructor(t,e){this.id=t,this.data=e,this.dataChildren=[]}iroots(){return a([this])}roots(){return[this]}*iterChildren(){for(const{child:t}of this.dataChildren)yield t}ichildren(){return a(this.iterChildren())}children(){return[...this.ichildren()]}*iterChildLinks(){for(const{child:t,data:e,points:r}of this.dataChildren)yield new f(this,t,e,r)}ichildLinks(){return a(this.iterChildLinks())}childLinks(){return[...this.ichildLinks()]}[Symbol.iterator](){return new p([this])[Symbol.iterator]()}idescendants(t="depth"){return new p([this]).idescendants(t)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return new p([this]).ilinks()}links(){return[...this.ilinks()]}size(){return new p([this]).size()}sum(t){return new p([this]).sum(t),this}count(){return new p([this]).count(),this}height(){return new p([this]).height(),this}depth(){return new p([this]).depth(),this}split(){return[this]}connected(){return!0}}class p{constructor(t){this.dagRoots=t}[Symbol.iterator](){return this.idepth()}iroots(){return a(this.dagRoots)}roots(){return this.dagRoots.slice()}*idepth(){const t=this.roots(),e=new Set;let r;for(;r=t.pop();)e.has(r.id)||(e.add(r.id),yield r,t.push(...r.ichildren()))}*ibreadth(){const t=new Set;let e=this.roots(),r=[];do{let n;for(r=e.reverse(),e=[];n=r.pop();)t.has(n.id)||(t.add(n.id),yield n,e.push(...n.ichildren()))}while(e.length)}*ibefore(){const t=new l;for(const e of this)for(const r of e.ichildren())t.set(r.id,t.getDefault(r.id,0)+1);const e=this.roots();let r;for(;r=e.pop();){yield r;for(const n of r.ichildren()){const r=t.getThrow(n.id);r>1?t.set(n.id,r-1):e.push(n)}}}*iafter(){const t=this.roots(),e=new Set;let r;for(;r=t.pop();)e.has(r.id)||(r.ichildren().every((t=>e.has(t.id)))?(e.add(r.id),yield r):(t.push(r),t.push(...r.ichildren())))}idescendants(t="depth"){if("depth"===t)return a(this.idepth());if("breadth"===t)return a(this.ibreadth());if("before"===t)return a(this.ibefore());if("after"===t)return a(this.iafter());throw new Error(`unknown iteration style: ${t}`)}descendants(t="depth"){return[...this.idescendants(t)]}ilinks(){return this.idescendants().flatMap((t=>t.ichildLinks()))}links(){return[...this.ilinks()]}size(){return this.idescendants().reduce((t=>t+1),0)}sum(t){const e=new l;for(const[r,n]of this.idescendants("after").entries()){const i=t(n,r),o=new l;o.set(n.id,i);for(const t of n.ichildren()){const r=e.getThrow(t.id);for(const[t,e]of r.entries())o.set(t,e)}n.value=a(o.entries()).map((([,t])=>t)).reduce(((t,e)=>t+e)),e.set(n.id,o)}return this}count(){const t=new l;for(const e of this.idescendants("after"))if(e.ichildren()[Symbol.iterator]().next().done)t.set(e.id,new Set([e.id])),e.value=1;else{const r=new Set;for(const n of e.ichildren()){const e=t.getThrow(n.id);for(const t of e)r.add(t)}t.set(e.id,r),e.value=r.size}return this}height(){for(const t of this.idescendants("after"))t.value=Math.max(0,...t.ichildren().map((t=>{if(void 0===t.value)throw new Error("`after` iteration didn't iterate in after order");return t.value+1})));return this}depth(){const t=new l;for(const e of this)for(const r of e.ichildren())t.setIfAbsent(r.id,[]).push(e);for(const e of this.idescendants("before"))e.value=Math.max(0,...t.getDefault(e.id,[]).map((t=>{if(void 0===t.value)throw new Error("`before` iteration didn't iterate in before order");return t.value+1})));return this}split(){const t=new l,e=new l;for(const r of this.iroots())t.set(r.id,[]),e.set(r.id,new Set(r.idescendants().map((t=>t.id))));for(const[r,n]of this.iroots().entries()){const i=e.getThrow(n.id);for(const o of this.iroots().slice(r+1)){c(i,e.getThrow(o.id))&&(t.getThrow(n.id).push(o),t.getThrow(o.id).push(n))}}const r=[],n=new Set;for(const e of this.iroots())if(!n.has(e.id)){n.add(e.id);const i=[e];r.push(i);const o=t.getThrow(e.id).slice();let s;for(;s=o.pop();)n.has(s.id)||(n.add(s.id),i.push(s),o.push(...t.getThrow(s.id)))}return r.map((t=>t.length>1?new p(t):t[0]))}connected(){return 1===this.split().length}}function v(t){if("string"!=typeof t)throw new Error("id is supposed to be string but got type "+typeof t);if(t.indexOf("\0")>=0)throw new Error(`node id ${t} contained null character`);return t}function g(t){if(!t.length)throw new Error("dag contained no roots");const e=new Set,r=new Set;let n=null;function i(t){if(e.has(t.id))return[];if(r.has(t.id))return n=t.id,[t.id];{r.add(t.id);let o=[];for(const e of t.ichildren())if(o=i(e),o.length)break;return r.delete(t.id),e.add(t.id),o.length&&null!==n&&o.push(t.id),n===t.id&&(n=null),o}}for(const e of t){const t=i(e);if(t.length)throw new Error("dag contained a cycle: "+t.reverse().join(" -> "))}for(const e of new p(t)){if(new Set(e.ichildren().map((t=>t.id))).size!==e.dataChildren.length)throw new Error(`node '${e.id}' contained duplicate children`)}}function m(t,e,r){function n(e){if(!e.length)throw new Error("can't stratify empty data");const n=e.map(((e,r)=>new d(v(t(e,r)),e))),i=new Map;n.forEach((t=>{if(i.has(t.id))throw new Error(`found a duplicate id: ${t.id}`);i.set(t.id,t)}));const o=[];return n.forEach(((t,e)=>{const n=r(t.data,e)||[];n.forEach((([e,r])=>{const n=i.get(e);if(!n)throw new Error(`missing id: ${e}`);return n.dataChildren.push(new u(t,r)),n})),n.length||o.push(t)})),g(o),o.length>1?new p(o):o[0]}return n.id=function(n){return void 0===n?t:m(n,e,r)},n.parentData=function(e){return void 0===e?r:m(t,function(t){function e(e,r){return(t(e,r)||[]).map((([t])=>t))}return e.wrapped=t,e}(e),e)},n.parentIds=function(r){return void 0===r?e:m(t,r,w(r))},n}function w(t){function e(e,r){return(t(e,r)||[]).map((t=>[t,void 0]))}return e.wrapped=t,e}function b(t){if(function(t){try{return"string"==typeof t.id}catch(t){return!1}}(t))return t.id;throw new Error(`default id function expected datum to have an id field but got: ${t}`)}function y(t){if(function(t){try{const e=t.parentIds;return void 0===e||e instanceof Array&&e.every((t=>"string"==typeof t))}catch(t){return!1}}(t))return t.parentIds;throw new Error(`default parentIds function expected datum to have a parentIds field but got: ${t}`)}function x(t,e){function r(r){if(!r.length)throw new Error("can't connect empty data");const n=new Map,i=new Map;for(const[o,s]of r.entries()){const r=v(t(s,o));let a=n.get(r);void 0===a&&(a=new d(r,void 0),n.set(r,a));const h=v(e(s,o));let c=n.get(h);void 0===c&&(c=new d(h,void 0),n.set(h,c)),a.dataChildren.push(new u(c,s)),i.set(r,i.get(r)||!1),i.set(h,!0)}const o=[];for(const[t,e]of i)e||o.push(h(n.get(t)));return g(o),o.length>1?new p(o):o[0]}return r.sourceId=function(r){return void 0===r?t:x(r,e)},r.targetId=function(r){return void 0===r?e:x(t,r)},r}function I(t){if(function(t){try{return"string"==typeof t[0]}catch(t){return!1}}(t))return t[0];throw new Error(`default source id expected datum[0] to be a string but got datum: ${t}`)}function C(t){if(function(t){try{return"string"==typeof t[1]}catch(t){return!1}}(t))return t[1];throw new Error(`default target id expected datum[1] to be a string but got datum: ${t}`)}function E(t,e,r){function n(...e){if(!e.length)throw new Error("must pass in at least one node");const n=new Map,i=[];function o(e){const r=v(t(e));let o=n.get(r);if(void 0===o)o=new d(r,e),n.set(r,o),i.push(o);else if(e!==o.data)throw new Error(`found duplicate id with different data: ${r}`);return o}const s=e.map(o);let a,h=0;for(;a=i.pop();)a.dataChildren=(r(a.data,h++)||[]).map((([t,e])=>new u(o(t),e)));const c=new Set(s.map((t=>t.id)));for(const t of n.values())if(t.ichildren().some((t=>c.has(t.id))))throw new Error(`node ${t.id} pointed to a root`);return g(s),s.length>1?new p(s):s[0]}return n.id=function(n){return void 0===n?t:E(n,e,r)},n.children=function(r){return void 0===r?e:E(t,r,O(r))},n.childrenData=function(e){return void 0===e?r:E(t,function(t){function e(e,r){return(t(e,r)||[]).map((([t])=>t))}return e.wrapped=t,e}(e),e)},n}function O(t){function e(e,r){return(t(e,r)||[]).map((t=>[t,void 0]))}return e.wrapped=t,e}function B(t){if(function(t){try{return"string"==typeof t.id}catch(t){return!1}}(t))return t.id;throw new Error(`default id function expected datum to have an id field by got: ${t}`)}function M(t){if(function(t){try{const e=t.children;return void 0===e||e instanceof Array}catch(t){return!1}}(t))return t.children;throw new Error(`default children function expected datum to have a children field but got: ${t}`)}
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */
function j(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}let V,$,z=1e-60;do{z+=z,V=1+.1*z,$=1+.2*z}while(V<=1||$<=1);var k=z;var T=function(t,e,r){let n,i;for(let e=1;e<=r;e+=1){t[e][e]=1/t[e][e],i=-t[e][e];for(let r=1;r<e;r+=1)t[r][e]*=i;if(n=e+1,r<n)break;for(let o=n;o<=r;o+=1){i=t[e][o],t[e][o]=0;for(let r=1;r<=e;r+=1)t[r][o]+=i*t[r][e]}}};var S=function(t,e,r,n){let i,o;for(i=1;i<=r;i+=1){o=0;for(let e=1;e<i;e+=1)o+=t[e][i]*n[e];n[i]=(n[i]-o)/t[i][i]}for(let e=1;e<=r;e+=1){i=r+1-e,n[i]/=t[i][i],o=-n[i];for(let e=1;e<i;e+=1)n[e]+=o*t[e][i]}};var _=function(t,e,r,n){let i,o,s;for(let e=1;e<=r;e+=1){if(n[1]=e,s=0,i=e-1,i<1){if(s=t[e][e]-s,s<=0)break;t[e][e]=Math.sqrt(s)}else{for(let r=1;r<=i;r+=1){o=t[r][e];for(let n=1;n<r;n+=1)o-=t[n][e]*t[n][r];o/=t[r][r],t[r][e]=o,s+=o*o}if(s=t[e][e]-s,s<=0)break;t[e][e]=Math.sqrt(s)}n[1]=0}};var R=function(t,e,r,n,i,o,s,a,h,c,l,u,f,d=0,p,v,g){let m,w,b,y,x,I,C,E,O,B,M,j,V,$;const z=Math.min(n,l);let R=2*n+z*(z+5)/2+2*l+1;for(let t=1;t<=n;t+=1)v[t]=e[t];for(let t=n+1;t<=R;t+=1)v[t]=0;for(let t=1;t<=l;t+=1)f[t]=0,o[t]=0;const N=[];if(0===g[1]){if(_(t,r,n,N),0!==N[1])return void(g[1]=2);S(t,r,n,e),T(t,r,n)}else{for(let r=1;r<=n;r+=1){i[r]=0;for(let n=1;n<=r;n+=1)i[r]+=t[n][r]*e[n]}for(let r=1;r<=n;r+=1){e[r]=0;for(let o=r;o<=n;o+=1)e[r]+=t[r][o]*i[o]}}s[1]=0;for(let r=1;r<=n;r+=1){i[r]=e[r],s[1]+=v[r]*i[r],v[r]=0;for(let e=r+1;e<=n;e+=1)t[e][r]=0}s[1]=-s[1]/2,g[1]=0;const P=n,A=P+n,D=A+z,q=D+z+1,F=q+z*(z+1)/2,L=F+l;for(let t=1;t<=l;t+=1){I=0;for(let e=1;e<=n;e+=1)I+=a[e][t]*a[e][t];v[L+t]=Math.sqrt(I)}function U(){p[1]+=1,R=F;for(let t=1;t<=l;t+=1){R+=1,I=-h[t];for(let e=1;e<=n;e+=1)I+=a[e][t]*i[e];if(Math.abs(I)<k&&(I=0),t>u)v[R]=I;else if(v[R]=-Math.abs(I),I>0){for(let e=1;e<=n;e+=1)a[e][t]=-a[e][t];h[t]=-h[t]}}for(let t=1;t<=y;t+=1)v[F+f[t]]=0;b=0,x=0;for(let t=1;t<=l;t+=1)v[F+t]<x*v[L+t]&&(b=t,x=v[F+t]/v[L+t]);if(0===b){for(let t=1;t<=y;t+=1)o[f[t]]=v[D+t];return 999}return 0}function H(){for(let e=1;e<=n;e+=1){I=0;for(let r=1;r<=n;r+=1)I+=t[r][e]*a[r][b];v[e]=I}m=P;for(let t=1;t<=n;t+=1)v[m+t]=0;for(let e=y+1;e<=n;e+=1)for(let r=1;r<=n;r+=1)v[m+r]=v[m+r]+t[r][e]*v[e];j=!0;for(let t=y;t>=1;t-=1){I=v[t],R=q+t*(t+3)/2,m=R-t;for(let e=t+1;e<=y;e+=1)I-=v[R]*v[A+e],R+=e;I/=v[m],v[A+t]=I,f[t]<=u||(I<=0||(j=!1,w=t))}if(!j){C=v[D+w]/v[A+w];for(let t=1;t<=y;t+=1)f[t]<=u||v[A+t]<=0||(x=v[D+t]/v[A+t],x<C&&(C=x,w=t))}I=0;for(let t=P+1;t<=P+n;t+=1)I+=v[t]*v[t];if(Math.abs(I)<=k){if(j)return g[1]=1,999;for(let t=1;t<=y;t+=1)v[D+t]=v[D+t]-C*v[A+t];return v[D+y+1]=v[D+y+1]+C,700}I=0;for(let t=1;t<=n;t+=1)I+=v[P+t]*a[t][b];E=-v[F+b]/I,V=!0,j||C<E&&(E=C,V=!1);for(let t=1;t<=n;t+=1)i[t]+=E*v[P+t],Math.abs(i[t])<k&&(i[t]=0);s[1]+=E*I*(E/2+v[D+y+1]);for(let t=1;t<=y;t+=1)v[D+t]=v[D+t]-E*v[A+t];if(v[D+y+1]=v[D+y+1]+E,!V){I=-h[b];for(let t=1;t<=n;t+=1)I+=i[t]*a[t][b];if(b>u)v[F+b]=I;else if(v[F+b]=-Math.abs(I),I>0){for(let t=1;t<=n;t+=1)a[t][b]=-a[t][b];h[b]=-h[b]}return 700}y+=1,f[y]=b,R=q+(y-1)*y/2+1;for(let t=1;t<=y-1;t+=1)v[R]=v[t],R+=1;if(y===n)v[R]=v[n];else{for(let e=n;e>=y+1;e-=1)if(0!==v[e]&&(O=Math.max(Math.abs(v[e-1]),Math.abs(v[e])),B=Math.min(Math.abs(v[e-1]),Math.abs(v[e])),x=v[e-1]>=0?Math.abs(O*Math.sqrt(1+B*B/(O*O))):-Math.abs(O*Math.sqrt(1+B*B/(O*O))),O=v[e-1]/x,B=v[e]/x,1!==O))if(0===O){v[e-1]=B*x;for(let r=1;r<=n;r+=1)x=t[r][e-1],t[r][e-1]=t[r][e],t[r][e]=x}else{v[e-1]=x,M=B/(1+O);for(let r=1;r<=n;r+=1)x=O*t[r][e-1]+B*t[r][e],t[r][e]=M*(t[r][e-1]+x)-t[r][e],t[r][e-1]=x}v[R]=v[y]}return 0}function W(){if(R=q+w*(w+1)/2+1,m=R+w,0===v[m])return 798;if(O=Math.max(Math.abs(v[m-1]),Math.abs(v[m])),B=Math.min(Math.abs(v[m-1]),Math.abs(v[m])),x=v[m-1]>=0?Math.abs(O*Math.sqrt(1+B*B/(O*O))):-Math.abs(O*Math.sqrt(1+B*B/(O*O))),O=v[m-1]/x,B=v[m]/x,1===O)return 798;if(0===O){for(let t=w+1;t<=y;t+=1)x=v[m-1],v[m-1]=v[m],v[m]=x,m+=t;for(let e=1;e<=n;e+=1)x=t[e][w],t[e][w]=t[e][w+1],t[e][w+1]=x}else{M=B/(1+O);for(let t=w+1;t<=y;t+=1)x=O*v[m-1]+B*v[m],v[m]=M*(v[m-1]+x)-v[m],v[m-1]=x,m+=t;for(let e=1;e<=n;e+=1)x=O*t[e][w]+B*t[e][w+1],t[e][w+1]=M*(t[e][w]+x)-t[e][w+1],t[e][w]=x}return 0}function G(){m=R-w;for(let t=1;t<=w;t+=1)v[m]=v[R],R+=1,m+=1;return v[D+w]=v[D+w+1],f[w]=f[w+1],w+=1,w<y?797:0}function J(){return v[D+y]=v[D+y+1],v[D+y+1]=0,f[y]=0,y-=1,p[2]+=1,0}for(y=d,p[1]=0,p[2]=0,$=0;;){if($=U(),999===$)return;for(;$=H(),0!==$;){if(999===$)return;if(700===$)if(w===y)J();else{for(;W(),$=G(),797===$;);J()}}}};var N={solveQP:function(t,e,r,n=[],i=0,o=[0,0]){const s=[],a=[],h=[],c=[],l=[],u=[];let f="";const d=t.length-1,p=r[1].length-1;if(!n)for(let t=1;t<=p;t+=1)n[t]=0;if(d!==t[1].length-1&&(f="Dmat is not symmetric!"),d!==e.length-1&&(f="Dmat and dvec are incompatible!"),d!==r.length-1&&(f="Amat and dvec are incompatible!"),p!==n.length-1&&(f="Amat and bvec are incompatible!"),(i>p||i<0)&&(f="Value of meq is invalid!"),""!==f)return{message:f};for(let t=1;t<=p;t+=1)a[t]=0,c[t]=0;const v=Math.min(d,p);for(let t=1;t<=d;t+=1)h[t]=0;s[1]=0;for(let t=1;t<=2*d+v*(v+5)/2+2*p+1;t+=1)l[t]=0;for(let t=1;t<=2;t+=1)u[t]=0;return R(t,e,d,d,h,c,s,r,n,d,p,i,a,0,u,l,o),1===o[1]&&(f="constraints are inconsistent, no solution!"),2===o[1]&&(f="matrix D in quadratic function is not positive definite!"),{solution:h,Lagrangian:c,value:s,unconstrained_solution:e,iterations:u,iact:a,message:f}}};function P(t,e,r,n,i=0){e.pop(),t.pop(),t.forEach((t=>t.pop())),r.forEach((t=>t.pop()));const o=function(t,e,r,n,i){if(!e.length)return[];const o=[[0]],s=[0],a=[[0]],h=[0];for(const e of t){const t=[0];t.push(...e),o.push(t)}s.push(...e),a.push(...e.map((()=>[0])));for(const t of r)for(const[e,r]of t.entries())a[e+1].push(-r);h.push(...n.map((t=>-t)));const{solution:c,message:l}=N.solveQP(o,s,a,h,i);if(l.length)throw new Error(`quadprog failed with: ${l}`);return c.shift(),c}(t,e,r,n,i);return o.push(0),o}function A(t,e,r){const n=1+Math.max(...e.values()),i=[],o=[];for(const s of t){let[t,...a]=s;for(const s of a){const a=e.getThrow(t.id),h=e.getThrow(s.id),c=new Array(n).fill(0);c[a]=1,c[h]=-1,i.push(c),o.push(-(r(t)[0]+r(s)[0])/2),t=s}}const s=new Array(n).fill(0);return[new Array(n).fill(null).map((()=>new Array(n).fill(0))),s,i,o]}function D(t,e,r,n){t[r][r]+=n,t[r][e]-=n,t[e][r]-=n,t[e][e]+=n}function q(t,e,r,n,i){t[n][n]+=i,t[n][r]-=2*i,t[n][e]+=i,t[r][n]-=2*i,t[r][r]+=4*i,t[r][e]-=2*i,t[e][n]+=i,t[e][r]-=2*i,t[e][e]+=i}function F(t,e,r,n){let i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(const s of t){const t=s[0],a=s[s.length-1];i=Math.min(i,n[r.getThrow(t.id)]-e(t)[0]/2),o=Math.max(o,n[r.getThrow(a.id)]+e(a)[0]/2)}for(const e of t)for(const t of e)t.x=n[r.getThrow(t.id)]-i;return o-i}class L extends d{constructor(t){super(t,void 0)}}function U(t){function e(e,r,n){const{vertNode:i,vertDummy:o,curveNode:s,curveDummy:a,comp:h}=t,c=function(t){const e=new l;let r=0;for(const n of t)for(const t of n)e.set(t.id,r++);return e}(e),[u,f,d,p]=A(e,c,r);for(const t of e)for(const e of t){const t=c.getThrow(e.id),r=e instanceof L?o:i;for(const n of e.ichildren()){const e=c.getThrow(n.id),h=n instanceof L?a:s;D(u,t,e,r+(n instanceof L?o:i));for(const r of n.ichildren()){q(u,t,e,c.getThrow(r.id),h)}}}for(let[t,...r]of e)for(const e of r)n.getThrow(t.id)!==n.getThrow(e.id)&&D(u,c.getThrow(t.id),c.getThrow(e.id),h),t=e;return F(e,r,c,P(u,f,d,p))}function r(r,n){const{vertNode:i,vertDummy:o,curveNode:s,curveDummy:a}=t;if(0===i&&0===s)throw new Error("node vertical weight or node curve weight needs to be positive");if(0===o&&0===a)throw new Error("dummy vertical weight or dummy curve weight needs to be positive");const u=function(t){const e=new l;for(const r of t.slice().reverse())for(const t of r){for(const r of t.ichildren())e.delete(r.id);e.set(t.id,t)}const r=new p([...e.values()]).split(),n=new l;for(const[t,e]of r.entries())for(const r of e)n.set(r.id,t);return n}(r),f=function(t,e){const r=[];let n=[],i=new Set;for(const o of t){const t=new Set(o.map((t=>e.getThrow(t.id))));c(i,t)||r.push(n=[]),n.push(o),i=t}return r}(r,u),d=f.map((t=>e(t,n,u))),v=Math.max(...d);if(v<=0)throw new Error("must assign nonzero width to at least one node");for(const[t,e]of f.entries()){const r=(v-d[t])/2;for(const t of e)for(const e of t)e.x=h(e.x)+r}return v}return r.vertical=function(e){if(void 0===e){const{vertNode:e,vertDummy:r}=t;return[e,r]}const[r,n]=e;if(r<0||n<0)throw new Error(`weights must be non-negative, but were ${r} and ${n}`);return U(Object.assign(Object.assign({},t),{vertNode:r,vertDummy:n}))},r.curve=function(e){if(void 0===e){const{curveNode:e,curveDummy:r}=t;return[e,r]}const[r,n]=e;if(r<0||n<0)throw new Error(`weights must be non-negative, but were ${r} and ${n}`);return U(Object.assign(Object.assign({},t),{curveNode:r,curveDummy:n}))},r.component=function(e){if(void 0===e)return t.comp;if(e<=0)throw new Error(`weight must be positive, but was ${e}`);return U(Object.assign(Object.assign({},t),{comp:e}))},r}function H(...t){if(t.length)throw new Error(`got arguments to quad(${t}), but constructor takes no aruguments.`);return U({vertNode:1,vertDummy:0,curveNode:0,curveDummy:1,comp:1})}function W(t,e,r,n){this.feasible=r,this.evaluation=e,this.bounded=n,this._tableau=t}var G=W;function J(t,e,r,n,i){G.call(this,t,e,r,n),this.iter=i}W.prototype.generateSolutionSet=function(){for(var t={},e=this._tableau,r=e.varIndexByRow,n=e.variablesPerIndex,i=e.matrix,o=e.rhsColumn,s=e.height-1,a=Math.round(1/e.precision),h=1;h<=s;h+=1){var c=n[r[h]];if(void 0!==c&&!0!==c.isSlack){var l=i[h][o];t[c.id]=Math.round((Number.EPSILON+l)*a)/a}}return t};var Z=J;function Q(t){this.model=null,this.matrix=null,this.width=0,this.height=0,this.costRowIndex=0,this.rhsColumn=0,this.variablesPerIndex=[],this.unrestrictedVars=null,this.feasible=!0,this.evaluation=0,this.simplexIters=0,this.varIndexByRow=null,this.varIndexByCol=null,this.rowByVarIndex=null,this.colByVarIndex=null,this.precision=t||1e-8,this.optionalObjectives=[],this.objectivesByPriority={},this.savedState=null,this.availableIndexes=[],this.lastElementIndex=0,this.variables=null,this.nVars=0,this.bounded=!0,this.unboundedVarIndex=null,this.branchAndCutIterations=0}J.prototype=Object.create(G.prototype),J.constructor=J;var Y=Q;function K(t,e){this.priority=t,this.reducedCosts=new Array(e);for(var r=0;r<e;r+=1)this.reducedCosts[r]=0}Q.prototype.solve=function(){return this.model.getNumberOfIntegerVariables()>0?this.branchAndCut():this.simplex(),this.updateVariableValues(),this.getSolution()},K.prototype.copy=function(){var t=new K(this.priority,this.reducedCosts.length);return t.reducedCosts=this.reducedCosts.slice(),t},Q.prototype.setOptionalObjective=function(t,e,r){var n=this.objectivesByPriority[t];void 0===n&&(n=new K(t,Math.max(this.width,e+1)),this.objectivesByPriority[t]=n,this.optionalObjectives.push(n),this.optionalObjectives.sort((function(t,e){return t.priority-e.priority})));n.reducedCosts[e]=r},Q.prototype.initialize=function(t,e,r,n){this.variables=r,this.unrestrictedVars=n,this.width=t,this.height=e;for(var i=new Array(t),o=0;o<t;o++)i[o]=0;this.matrix=new Array(e);for(var s=0;s<e;s++)this.matrix[s]=i.slice();this.varIndexByRow=new Array(this.height),this.varIndexByCol=new Array(this.width),this.varIndexByRow[0]=-1,this.varIndexByCol[0]=-1,this.nVars=t+e-2,this.rowByVarIndex=new Array(this.nVars),this.colByVarIndex=new Array(this.nVars),this.lastElementIndex=this.nVars},Q.prototype._resetMatrix=function(){var t,e,r=this.model.variables,n=this.model.constraints,i=r.length,o=n.length,s=this.matrix[0],a=!0===this.model.isMinimization?-1:1;for(t=0;t<i;t+=1){var h=r[t],c=h.priority,l=a*h.cost;0===c?s[t+1]=l:this.setOptionalObjective(c,t+1,l),e=r[t].index,this.rowByVarIndex[e]=-1,this.colByVarIndex[e]=t+1,this.varIndexByCol[t+1]=e}for(var u=1,f=0;f<o;f+=1){var d,p,v=n[f],g=v.index;this.rowByVarIndex[g]=u,this.colByVarIndex[g]=-1,this.varIndexByRow[u]=g;var m=v.terms,w=m.length,b=this.matrix[u++];if(v.isUpperBound){for(d=0;d<w;d+=1)p=m[d],b[this.colByVarIndex[p.variable.index]]=p.coefficient;b[0]=v.rhs}else{for(d=0;d<w;d+=1)p=m[d],b[this.colByVarIndex[p.variable.index]]=-p.coefficient;b[0]=-v.rhs}}},Q.prototype.setModel=function(t){this.model=t;var e=t.nVariables+1,r=t.nConstraints+1;return this.initialize(e,r,t.variables,t.unrestrictedVariables),this._resetMatrix(),this},Q.prototype.getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},Q.prototype.density=function(){for(var t=0,e=this.matrix,r=0;r<this.height;r++)for(var n=e[r],i=0;i<this.width;i++)0!==n[i]&&(t+=1);return t/(this.height*this.width)},Q.prototype.setEvaluation=function(){var t=Math.round(1/this.precision),e=this.matrix[this.costRowIndex][this.rhsColumn],r=Math.round((Number.EPSILON+e)*t)/t;this.evaluation=r,0===this.simplexIters&&(this.bestPossibleEval=r)},Q.prototype.getSolution=function(){var t=!0===this.model.isMinimization?this.evaluation:-this.evaluation;return this.model.getNumberOfIntegerVariables()>0?new Z(this,t,this.feasible,this.bounded,this.branchAndCutIterations):new G(this,t,this.feasible,this.bounded)},Y.prototype.simplex=function(){return this.bounded=!0,this.phase1(),!0===this.feasible&&this.phase2(),this},Y.prototype.phase1=function(){for(var t=this.model.checkForCycles,e=[],r=this.matrix,n=this.rhsColumn,i=this.width-1,o=this.height-1,s=0;;){for(var a=0,h=-this.precision,c=1;c<=o;c++){!0===this.unrestrictedVars[this.varIndexByRow[c]];var l=r[c][n];l<h&&(h=l,a=c)}if(0===a)return this.feasible=!0,s;for(var u=0,f=-1/0,d=r[0],p=r[a],v=1;v<=i;v++){var g=p[v];if(!0===this.unrestrictedVars[this.varIndexByCol[v]]||g<-this.precision){var m=-d[v]/g;f<m&&(f=m,u=v)}}if(0===u)return this.feasible=!1,s;if(t){e.push([this.varIndexByRow[a],this.varIndexByCol[u]]);var w=this.checkForCycles(e);if(w.length>0)return this.model.messages.push("Cycle in phase 1"),this.model.messages.push("Start :"+w[0]),this.model.messages.push("Length :"+w[1]),this.feasible=!1,s}this.pivot(a,u),s+=1}},Y.prototype.phase2=function(){for(var t,e,r=this.model.checkForCycles,n=[],i=this.matrix,o=this.rhsColumn,s=this.width-1,a=this.height-1,h=this.precision,c=this.optionalObjectives.length,l=null,u=0;;){var f=i[this.costRowIndex];c>0&&(l=[]);for(var d=0,p=h,v=!1,g=1;g<=s;g++)t=f[g],e=!0===this.unrestrictedVars[this.varIndexByCol[g]],c>0&&-h<t&&t<h?l.push(g):e&&t<0?-t>p&&(p=-t,d=g,v=!0):t>p&&(p=t,d=g,v=!1);if(c>0)for(var m=0;0===d&&l.length>0&&m<c;){var w=[],b=this.optionalObjectives[m].reducedCosts;p=h;for(var y=0;y<l.length;y++)t=b[g=l[y]],e=!0===this.unrestrictedVars[this.varIndexByCol[g]],-h<t&&t<h?w.push(g):e&&t<0?-t>p&&(p=-t,d=g,v=!0):t>p&&(p=t,d=g,v=!1);l=w,m+=1}if(0===d)return this.setEvaluation(),this.simplexIters+=1,u;for(var x=0,I=1/0,C=(this.varIndexByRow,1);C<=a;C++){var E=i[C],O=E[o],B=E[d];if(!(-h<B&&B<h)){if(B>0&&h>O&&O>-h){I=0,x=C;break}var M=v?-O/B:O/B;M>h&&I>M&&(I=M,x=C)}}if(I===1/0)return this.evaluation=-1/0,this.bounded=!1,this.unboundedVarIndex=this.varIndexByCol[d],u;if(r){n.push([this.varIndexByRow[x],this.varIndexByCol[d]]);var j=this.checkForCycles(n);if(j.length>0)return this.model.messages.push("Cycle in phase 2"),this.model.messages.push("Start :"+j[0]),this.model.messages.push("Length :"+j[1]),this.feasible=!1,u}this.pivot(x,d,!0),u+=1}};var X=[];function tt(t,e,r,n){this.id=t,this.cost=e,this.index=r,this.value=0,this.priority=n}function et(t,e,r,n){tt.call(this,t,e,r,n)}function rt(t,e){tt.call(this,t,0,e,0)}function nt(t,e){this.variable=t,this.coefficient=e}function it(t,e,r){return 0===r||"required"===r?null:(e=e||1,r=r||1,!1===t.isMinimization&&(e=-e),t.addVariable(e,"r"+t.relaxationIndex++,!1,!1,r))}function ot(t,e,r,n){this.slack=new rt("s"+r,r),this.index=r,this.model=n,this.rhs=t,this.isUpperBound=e,this.terms=[],this.termsByVarIndex={},this.relaxation=null}function st(t,e){this.upperBound=t,this.lowerBound=e,this.model=t.model,this.rhs=t.rhs,this.relaxation=null}Y.prototype.pivot=function(t,e){var r=this.matrix,n=r[t][e],i=this.height-1,o=this.width-1,s=this.varIndexByRow[t],a=this.varIndexByCol[e];this.varIndexByRow[t]=a,this.varIndexByCol[e]=s,this.rowByVarIndex[a]=t,this.rowByVarIndex[s]=-1,this.colByVarIndex[a]=-1,this.colByVarIndex[s]=e;for(var h,c,l,u=r[t],f=0,d=0;d<=o;d++)u[d]>=-1e-16&&u[d]<=1e-16?u[d]=0:(u[d]/=n,X[f]=d,f+=1);u[e]=1/n;this.precision;for(var p=0;p<=i;p++)if(p!==t&&!(r[p][e]>=-1e-16&&r[p][e]<=1e-16)){var v=r[p];if((h=v[e])>=-1e-16&&h<=1e-16)0!==h&&(v[e]=0);else{for(c=0;c<f;c++)(l=u[d=X[c]])>=-1e-16&&l<=1e-16?0!==l&&(u[d]=0):v[d]=v[d]-h*l;v[e]=-h/n}}var g=this.optionalObjectives.length;if(g>0)for(var m=0;m<g;m+=1){var w=this.optionalObjectives[m].reducedCosts;if(0!==(h=w[e])){for(c=0;c<f;c++)0!==(l=u[d=X[c]])&&(w[d]=w[d]-h*l);w[e]=-h/n}}},Y.prototype.checkForCycles=function(t){for(var e=0;e<t.length-1;e++)for(var r=e+1;r<t.length;r++){var n=t[e],i=t[r];if(n[0]===i[0]&&n[1]===i[1]){if(r-e>t.length-r)break;for(var o=!0,s=1;s<r-e;s++){var a=t[e+s],h=t[r+s];if(a[0]!==h[0]||a[1]!==h[1]){o=!1;break}}if(o)return[e,r-e]}}return[]},et.prototype.isInteger=!0,rt.prototype.isSlack=!0,ot.prototype.addTerm=function(t,e){var r=e.index,n=this.termsByVarIndex[r];if(void 0===n)n=new nt(e,t),this.termsByVarIndex[r]=n,this.terms.push(n),!0===this.isUpperBound&&(t=-t),this.model.updateConstraintCoefficient(this,e,t);else{var i=n.coefficient+t;this.setVariableCoefficient(i,e)}return this},ot.prototype.removeTerm=function(t){return this},ot.prototype.setRightHandSide=function(t){if(t!==this.rhs){var e=t-this.rhs;!0===this.isUpperBound&&(e=-e),this.rhs=t,this.model.updateRightHandSide(this,e)}return this},ot.prototype.setVariableCoefficient=function(t,e){var r=e.index;if(-1!==r){var n=this.termsByVarIndex[r];if(void 0===n)this.addTerm(t,e);else if(t!==n.coefficient){var i=t-n.coefficient;!0===this.isUpperBound&&(i=-i),n.coefficient=t,this.model.updateConstraintCoefficient(this,e,i)}return this}console.warn("[Constraint.setVariableCoefficient] Trying to change coefficient of inexistant variable.")},ot.prototype.relax=function(t,e){this.relaxation=it(this.model,t,e),this._relax(this.relaxation)},ot.prototype._relax=function(t){null!==t&&(this.isUpperBound?this.setVariableCoefficient(-1,t):this.setVariableCoefficient(1,t))},st.prototype.isEquality=!0,st.prototype.addTerm=function(t,e){return this.upperBound.addTerm(t,e),this.lowerBound.addTerm(t,e),this},st.prototype.removeTerm=function(t){return this.upperBound.removeTerm(t),this.lowerBound.removeTerm(t),this},st.prototype.setRightHandSide=function(t){this.upperBound.setRightHandSide(t),this.lowerBound.setRightHandSide(t),this.rhs=t},st.prototype.relax=function(t,e){this.relaxation=it(this.model,t,e),this.upperBound.relaxation=this.relaxation,this.upperBound._relax(this.relaxation),this.lowerBound.relaxation=this.relaxation,this.lowerBound._relax(this.relaxation)};var at={Constraint:ot,Variable:tt,IntegerVariable:et,SlackVariable:rt,Equality:st,Term:nt},ht=at.SlackVariable;function ct(t,e){this.index=t,this.value=e}Y.prototype.addCutConstraints=function(t){for(var e,r=t.length,n=this.height,i=n+r,o=n;o<i;o+=1)void 0===this.matrix[o]&&(this.matrix[o]=this.matrix[o-1].slice());this.height=i,this.nVars=this.width+this.height-2;for(var s=this.width-1,a=0;a<r;a+=1){var h=t[a],c=n+a,l="min"===h.type?-1:1,u=h.varIndex,f=this.rowByVarIndex[u],d=this.matrix[c];if(-1===f){for(d[this.rhsColumn]=l*h.value,e=1;e<=s;e+=1)d[e]=0;d[this.colByVarIndex[u]]=l}else{var p=this.matrix[f],v=p[this.rhsColumn];for(d[this.rhsColumn]=l*(h.value-v),e=1;e<=s;e+=1)d[e]=-l*p[e]}var g=this.getNewElementIndex();this.varIndexByRow[c]=g,this.rowByVarIndex[g]=c,this.colByVarIndex[g]=-1,this.variablesPerIndex[g]=new ht("s"+g,g),this.nVars+=1}},Y.prototype._addLowerBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var r=e[t][this.rhsColumn],n=r-Math.floor(r);if(n<this.precision||1-this.precision<n)return!1;var i=this.height;e[i]=e[i-1].slice(),this.height+=1,this.nVars+=1;var o=this.getNewElementIndex();this.varIndexByRow[i]=o,this.rowByVarIndex[o]=i,this.colByVarIndex[o]=-1,this.variablesPerIndex[o]=new ht("s"+o,o),e[i][this.rhsColumn]=Math.floor(r);for(var s=1;s<this.varIndexByCol.length;s+=1){if(this.variablesPerIndex[this.varIndexByCol[s]].isInteger){var a=e[t][s],h=Math.floor(a)+Math.max(0,a-Math.floor(a)-n)/(1-n);e[i][s]=h}else e[i][s]=Math.min(0,e[t][s]/(1-n))}for(var c=0;c<this.width;c+=1)e[i][c]-=e[t][c];return!0},Y.prototype._addUpperBoundMIRCut=function(t){if(t===this.costRowIndex)return!1;this.model;var e=this.matrix;if(!this.variablesPerIndex[this.varIndexByRow[t]].isInteger)return!1;var r=e[t][this.rhsColumn],n=r-Math.floor(r);if(n<this.precision||1-this.precision<n)return!1;var i=this.height;e[i]=e[i-1].slice(),this.height+=1,this.nVars+=1;var o=this.getNewElementIndex();this.varIndexByRow[i]=o,this.rowByVarIndex[o]=i,this.colByVarIndex[o]=-1,this.variablesPerIndex[o]=new ht("s"+o,o),e[i][this.rhsColumn]=-n;for(var s=1;s<this.varIndexByCol.length;s+=1){var a=this.variablesPerIndex[this.varIndexByCol[s]],h=e[t][s],c=h-Math.floor(h);a.isInteger?e[i][s]=c<=n?-c:-(1-c)*n/c:e[i][s]=h>=0?-h:h*n/(1-n)}return!0},Y.prototype.applyMIRCuts=function(){},Y.prototype._putInBase=function(t){var e=this.rowByVarIndex[t];if(-1===e){for(var r=this.colByVarIndex[t],n=1;n<this.height;n+=1){var i=this.matrix[n][r];if(i<-this.precision||this.precision<i){e=n;break}}this.pivot(e,r)}return e},Y.prototype._takeOutOfBase=function(t){var e=this.colByVarIndex[t];if(-1===e){for(var r=this.rowByVarIndex[t],n=this.matrix[r],i=1;i<this.height;i+=1){var o=n[i];if(o<-this.precision||this.precision<o){e=i;break}}this.pivot(r,e)}return e},Y.prototype.updateVariableValues=function(){for(var t=this.variables.length,e=Math.round(1/this.precision),r=0;r<t;r+=1){var n=this.variables[r],i=n.index,o=this.rowByVarIndex[i];if(-1===o)n.value=0;else{var s=this.matrix[o][this.rhsColumn];n.value=Math.round((s+Number.EPSILON)*e)/e}}},Y.prototype.updateRightHandSide=function(t,e){var r=this.height-1,n=this.rowByVarIndex[t.index];if(-1===n){for(var i=this.colByVarIndex[t.index],o=0;o<=r;o+=1){var s=this.matrix[o];s[this.rhsColumn]-=e*s[i]}var a=this.optionalObjectives.length;if(a>0)for(var h=0;h<a;h+=1){var c=this.optionalObjectives[h].reducedCosts;c[this.rhsColumn]-=e*c[i]}}else this.matrix[n][this.rhsColumn]-=e},Y.prototype.updateConstraintCoefficient=function(t,e,r){if(t.index===e.index)throw new Error("[Tableau.updateConstraintCoefficient] constraint index should not be equal to variable index !");var n=this._putInBase(t.index),i=this.colByVarIndex[e.index];if(-1===i)for(var o=this.rowByVarIndex[e.index],s=0;s<this.width;s+=1)this.matrix[n][s]+=r*this.matrix[o][s];else this.matrix[n][i]-=r},Y.prototype.updateCost=function(t,e){var r=t.index,n=this.width-1,i=this.colByVarIndex[r];if(-1===i){var o,s=this.matrix[this.rowByVarIndex[r]];if(0===t.priority){var a=this.matrix[0];for(o=0;o<=n;o+=1)a[o]+=e*s[o]}else{var h=this.objectivesByPriority[t.priority].reducedCosts;for(o=0;o<=n;o+=1)h[o]+=e*s[o]}}else this.matrix[0][i]-=e},Y.prototype.addConstraint=function(t){var e=t.isUpperBound?1:-1,r=this.height,n=this.matrix[r];void 0===n&&(n=this.matrix[0].slice(),this.matrix[r]=n);for(var i=this.width-1,o=0;o<=i;o+=1)n[o]=0;n[this.rhsColumn]=e*t.rhs;for(var s=t.terms,a=s.length,h=0;h<a;h+=1){var c=s[h],l=c.coefficient,u=c.variable.index,f=this.rowByVarIndex[u];if(-1===f)n[this.colByVarIndex[u]]+=e*l;else{var d=this.matrix[f];d[this.rhsColumn];for(o=0;o<=i;o+=1)n[o]-=e*l*d[o]}}var p=t.index;this.varIndexByRow[r]=p,this.rowByVarIndex[p]=r,this.colByVarIndex[p]=-1,this.height+=1},Y.prototype.removeConstraint=function(t){var e=t.index,r=this.height-1,n=this._putInBase(e),i=this.matrix[r];this.matrix[r]=this.matrix[n],this.matrix[n]=i,this.varIndexByRow[n]=this.varIndexByRow[r],this.varIndexByRow[r]=-1,this.rowByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.slack.index=-1,this.height-=1},Y.prototype.addVariable=function(t){var e=this.height-1,r=this.width,n=!0===this.model.isMinimization?-t.cost:t.cost,i=t.priority,o=this.optionalObjectives.length;if(o>0)for(var s=0;s<o;s+=1)this.optionalObjectives[s].reducedCosts[r]=0;0===i?this.matrix[0][r]=n:(this.setOptionalObjective(i,r,n),this.matrix[0][r]=0);for(var a=1;a<=e;a+=1)this.matrix[a][r]=0;var h=t.index;this.varIndexByCol[r]=h,this.rowByVarIndex[h]=-1,this.colByVarIndex[h]=r,this.width+=1},Y.prototype.removeVariable=function(t){var e=t.index,r=this._takeOutOfBase(e),n=this.width-1;if(r!==n){for(var i=this.height-1,o=0;o<=i;o+=1){var s=this.matrix[o];s[r]=s[n]}var a=this.optionalObjectives.length;if(a>0)for(var h=0;h<a;h+=1){var c=this.optionalObjectives[h].reducedCosts;c[r]=c[n]}var l=this.varIndexByCol[n];this.varIndexByCol[r]=l,this.colByVarIndex[l]=r}this.varIndexByCol[n]=-1,this.colByVarIndex[e]=-1,this.availableIndexes[this.availableIndexes.length]=e,t.index=-1,this.width-=1},Y.prototype.log=function(t,e){console.log("****",t,"****"),console.log("Nb Variables",this.width-1),console.log("Nb Constraints",this.height-1),console.log("Basic Indexes",this.varIndexByRow),console.log("Non Basic Indexes",this.varIndexByCol),console.log("Rows",this.rowByVarIndex),console.log("Cols",this.colByVarIndex);var r,n,i,o,s,a,h,c,l,u,f="",d=[" "];for(n=1;n<this.width;n+=1)s=this.varIndexByCol[n],h=" ",c="\t",(a=void 0===(o=this.variablesPerIndex[s])?"c"+s:o.id).length>5?h+=" ":c+="\t",d[n]=h,f+=c+a;console.log(f);var p=this.matrix[this.costRowIndex],v="\t";for(r=1;r<this.width;r+=1)v+="\t",v+=d[r],v+=p[r].toFixed(5);for(v+="\t"+d[0]+p[0].toFixed(5),console.log(v+"\tZ"),i=1;i<this.height;i+=1){for(l=this.matrix[i],u="\t",n=1;n<this.width;n+=1)u+="\t"+d[n]+l[n].toFixed(5);u+="\t"+d[0]+l[0].toFixed(5),s=this.varIndexByRow[i],a=void 0===(o=this.variablesPerIndex[s])?"c"+s:o.id,console.log(u+"\t"+a)}console.log("");var g=this.optionalObjectives.length;if(g>0){console.log("    Optional objectives:");for(var m=0;m<g;m+=1){var w=this.optionalObjectives[m].reducedCosts,b="";for(r=1;r<this.width;r+=1)b+=w[r]<0?"":" ",b+=d[r],b+=w[r].toFixed(5);b+=(w[0]<0?"":" ")+d[0]+w[0].toFixed(5),console.log(b+" z"+m)}}return console.log("Feasible?",this.feasible),console.log("evaluation",this.evaluation),this},Y.prototype.copy=function(){var t=new Y(this.precision);t.width=this.width,t.height=this.height,t.nVars=this.nVars,t.model=this.model,t.variables=this.variables,t.variablesPerIndex=this.variablesPerIndex,t.unrestrictedVars=this.unrestrictedVars,t.lastElementIndex=this.lastElementIndex,t.varIndexByRow=this.varIndexByRow.slice(),t.varIndexByCol=this.varIndexByCol.slice(),t.rowByVarIndex=this.rowByVarIndex.slice(),t.colByVarIndex=this.colByVarIndex.slice(),t.availableIndexes=this.availableIndexes.slice();for(var e=[],r=0;r<this.optionalObjectives.length;r++)e[r]=this.optionalObjectives[r].copy();t.optionalObjectives=e;for(var n=this.matrix,i=new Array(this.height),o=0;o<this.height;o++)i[o]=n[o].slice();return t.matrix=i,t},Y.prototype.save=function(){this.savedState=this.copy()},Y.prototype.restore=function(){if(null!==this.savedState){var t,e,r=this.savedState,n=r.matrix;for(this.nVars=r.nVars,this.model=r.model,this.variables=r.variables,this.variablesPerIndex=r.variablesPerIndex,this.unrestrictedVars=r.unrestrictedVars,this.lastElementIndex=r.lastElementIndex,this.width=r.width,this.height=r.height,t=0;t<this.height;t+=1){var i=n[t],o=this.matrix[t];for(e=0;e<this.width;e+=1)o[e]=i[e]}var s=r.varIndexByRow;for(e=0;e<this.height;e+=1)this.varIndexByRow[e]=s[e];for(;this.varIndexByRow.length>this.height;)this.varIndexByRow.pop();var a=r.varIndexByCol;for(t=0;t<this.width;t+=1)this.varIndexByCol[t]=a[t];for(;this.varIndexByCol.length>this.width;)this.varIndexByCol.pop();for(var h=r.rowByVarIndex,c=r.colByVarIndex,l=0;l<this.nVars;l+=1)this.rowByVarIndex[l]=h[l],this.colByVarIndex[l]=c[l];if(r.optionalObjectives.length>0&&this.optionalObjectives.length>0){this.optionalObjectives=[],this.optionalObjectivePerPriority={};for(var u=0;u<r.optionalObjectives.length;u++){var f=r.optionalObjectives[u].copy();this.optionalObjectives[u]=f,this.optionalObjectivePerPriority[f.priority]=f}}}},Y.prototype.getMostFractionalVar=function(){for(var t=0,e=null,r=null,n=this.model.integerVariables,i=n.length,o=0;o<i;o++){var s=n[o].index,a=this.rowByVarIndex[s];if(-1!==a){var h=this.matrix[a][this.rhsColumn],c=Math.abs(h-Math.round(h));t<c&&(t=c,e=s,r=h)}}return new ct(e,r)},Y.prototype.getFractionalVarWithLowestCost=function(){for(var t=1/0,e=null,r=null,n=this.model.integerVariables,i=n.length,o=0;o<i;o++){var s=n[o],a=s.index,h=this.rowByVarIndex[a];if(-1!==h){var c=this.matrix[h][this.rhsColumn];if(Math.abs(c-Math.round(c))>this.precision){var l=s.cost;t>l&&(t=l,e=a,r=c)}}}return new ct(e,r)},Y.prototype.countIntegerValues=function(){for(var t=0,e=1;e<this.height;e+=1)if(this.variablesPerIndex[this.varIndexByRow[e]].isInteger){var r=this.matrix[e][this.rhsColumn];(r-=Math.floor(r))<this.precision&&-r<this.precision&&(t+=1)}return t},Y.prototype.isIntegral=function(){for(var t=this.model.integerVariables,e=t.length,r=0;r<e;r++){var n=this.rowByVarIndex[t[r].index];if(-1!==n){var i=this.matrix[n][this.rhsColumn];if(Math.abs(i-Math.round(i))>this.precision)return!1}}return!0},Y.prototype.computeFractionalVolume=function(t){for(var e=-1,r=1;r<this.height;r+=1)if(this.variablesPerIndex[this.varIndexByRow[r]].isInteger){var n=this.matrix[r][this.rhsColumn];if(n=Math.abs(n),Math.min(n-Math.floor(n),Math.floor(n+1))<this.precision){if(!t)return 0}else-1===e?e=n:e*=n}return-1===e?0:e};var lt=Y;function ut(t,e,r){this.type=t,this.varIndex=e,this.value=r}function ft(t,e){this.relaxedEvaluation=t,this.cuts=e}function dt(t,e){return e.relaxedEvaluation-t.relaxedEvaluation}Y.prototype.applyCuts=function(t){if(this.restore(),this.addCutConstraints(t),this.simplex(),this.model.useMIRCuts)for(var e=!0;e;){var r=this.computeFractionalVolume(!0);this.applyMIRCuts(),this.simplex(),this.computeFractionalVolume(!0)>=.9*r&&(e=!1)}},Y.prototype.branchAndCut=function(){var t=[],e=0,r=this.model.tolerance,n=!0,i=1e99;this.model.timeout&&(i=Date.now()+this.model.timeout);for(var o=1/0,s=null,a=[],h=0;h<this.optionalObjectives.length;h+=1)a.push(1/0);var c,l=new ft(-1/0,[]);for(t.push(l);t.length>0&&!0===n&&Date.now()<i;)if(c=this.model.isMinimization?this.bestPossibleEval*(1+r):this.bestPossibleEval*(1-r),r>0&&o<c&&(n=!1),!((l=t.pop()).relaxedEvaluation>o)){var u=l.cuts;if(this.applyCuts(u),e++,!1!==this.feasible){var f=this.evaluation;if(!(f>o)){if(f===o){for(var d=!0,p=0;p<this.optionalObjectives.length&&!(this.optionalObjectives[p].reducedCosts[0]>a[p]);p+=1)if(this.optionalObjectives[p].reducedCosts[0]<a[p]){d=!1;break}if(d)continue}if(!0===this.isIntegral()){if(this.__isIntegral=!0,1===e)return void(this.branchAndCutIterations=e);s=l,o=f;for(var v=0;v<this.optionalObjectives.length;v+=1)a[v]=this.optionalObjectives[v].reducedCosts[0]}else{1===e&&this.save();for(var g=this.getMostFractionalVar(),m=g.index,w=[],b=[],y=u.length,x=0;x<y;x+=1){var I=u[x];I.varIndex===m?"min"===I.type?b.push(I):w.push(I):(w.push(I),b.push(I))}var C=Math.ceil(g.value),E=Math.floor(g.value),O=new ut("min",m,C);w.push(O);var B=new ut("max",m,E);b.push(B),t.push(new ft(f,w)),t.push(new ft(f,b)),t.sort(dt)}}}}null!==s&&this.applyCuts(s.cuts),this.branchAndCutIterations=e};var pt={},vt=at.Constraint,gt=at.Equality,mt=at.Variable,wt=at.IntegerVariable;function bt(t,e){this.tableau=new Y(t),this.name=e,this.variables=[],this.integerVariables=[],this.unrestrictedVariables={},this.constraints=[],this.nConstraints=0,this.nVariables=0,this.isMinimization=!0,this.tableauInitialized=!1,this.relaxationIndex=1,this.useMIRCuts=!1,this.checkForCycles=!0,this.messages=[]}var yt=bt;bt.prototype.minimize=function(){return this.isMinimization=!0,this},bt.prototype.maximize=function(){return this.isMinimization=!1,this},bt.prototype._getNewElementIndex=function(){if(this.availableIndexes.length>0)return this.availableIndexes.pop();var t=this.lastElementIndex;return this.lastElementIndex+=1,t},bt.prototype._addConstraint=function(t){var e=t.slack;this.tableau.variablesPerIndex[e.index]=e,this.constraints.push(t),this.nConstraints+=1,!0===this.tableauInitialized&&this.tableau.addConstraint(t)},bt.prototype.smallerThan=function(t){var e=new vt(t,!0,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},bt.prototype.greaterThan=function(t){var e=new vt(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(e),e},bt.prototype.equal=function(t){var e=new vt(t,!0,this.tableau.getNewElementIndex(),this);this._addConstraint(e);var r=new vt(t,!1,this.tableau.getNewElementIndex(),this);return this._addConstraint(r),new gt(e,r)},bt.prototype.addVariable=function(t,e,r,n,i){if("string"==typeof i)switch(i){case"required":i=0;break;case"strong":i=1;break;case"medium":i=2;break;case"weak":i=3;break;default:i=0}var o,s=this.tableau.getNewElementIndex();return null==e&&(e="v"+s),null==t&&(t=0),null==i&&(i=0),r?(o=new wt(e,t,s,i),this.integerVariables.push(o)):o=new mt(e,t,s,i),this.variables.push(o),this.tableau.variablesPerIndex[s]=o,n&&(this.unrestrictedVariables[s]=!0),this.nVariables+=1,!0===this.tableauInitialized&&this.tableau.addVariable(o),o},bt.prototype._removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e?(this.constraints.splice(e,1),this.nConstraints-=1,!0===this.tableauInitialized&&this.tableau.removeConstraint(t),t.relaxation&&this.removeVariable(t.relaxation)):console.warn("[Model.removeConstraint] Constraint not present in model")},bt.prototype.removeConstraint=function(t){return t.isEquality?(this._removeConstraint(t.upperBound),this._removeConstraint(t.lowerBound)):this._removeConstraint(t),this},bt.prototype.removeVariable=function(t){var e=this.variables.indexOf(t);if(-1!==e)return this.variables.splice(e,1),!0===this.tableauInitialized&&this.tableau.removeVariable(t),this;console.warn("[Model.removeVariable] Variable not present in model")},bt.prototype.updateRightHandSide=function(t,e){return!0===this.tableauInitialized&&this.tableau.updateRightHandSide(t,e),this},bt.prototype.updateConstraintCoefficient=function(t,e,r){return!0===this.tableauInitialized&&this.tableau.updateConstraintCoefficient(t,e,r),this},bt.prototype.setCost=function(t,e){var r=t-e.cost;return!1===this.isMinimization&&(r=-r),e.cost=t,this.tableau.updateCost(e,r),this},bt.prototype.loadJson=function(t){this.isMinimization="max"!==t.opType;for(var e=t.variables,r=t.constraints,n={},i={},o=Object.keys(r),s=o.length,a=0;a<s;a+=1){var h,c,l=o[a],u=r[l],f=u.equal,d=u.weight,p=u.priority,v=void 0!==d||void 0!==p;if(void 0===f){var g=u.min;void 0!==g&&(h=this.greaterThan(g),n[l]=h,v&&h.relax(d,p));var m=u.max;void 0!==m&&(c=this.smallerThan(m),i[l]=c,v&&c.relax(d,p))}else{h=this.greaterThan(f),n[l]=h,c=this.smallerThan(f),i[l]=c;var w=new gt(h,c);v&&w.relax(d,p)}}var b=Object.keys(e),y=b.length;this.tolerance=t.tolerance||0,t.timeout&&(this.timeout=t.timeout),t.options&&(t.options.timeout&&(this.timeout=t.options.timeout),0===this.tolerance&&(this.tolerance=t.options.tolerance||0),t.options.useMIRCuts&&(this.useMIRCuts=t.options.useMIRCuts),void 0===t.options.exitOnCycles?this.checkForCycles=!0:this.checkForCycles=t.options.exitOnCycles);for(var x=t.ints||{},I=t.binaries||{},C=t.unrestricted||{},E=t.optimize,O=0;O<y;O+=1){var B=b[O],M=e[B],j=M[E]||0,V=!!I[B],$=!!x[B]||V,z=!!C[B],k=this.addVariable(j,B,$,z);V&&this.smallerThan(1).addTerm(1,k);var T=Object.keys(M);for(a=0;a<T.length;a+=1){var S=T[a];if(S!==E){var _=M[S],R=n[S];void 0!==R&&R.addTerm(_,k);var N=i[S];void 0!==N&&N.addTerm(_,k)}}}return this},bt.prototype.getNumberOfIntegerVariables=function(){return this.integerVariables.length},bt.prototype.solve=function(){return!1===this.tableauInitialized&&(this.tableau.setModel(this),this.tableauInitialized=!0),this.tableau.solve()},bt.prototype.isFeasible=function(){return this.tableau.feasible},bt.prototype.save=function(){return this.tableau.save()},bt.prototype.restore=function(){return this.tableau.restore()},bt.prototype.activateMIRCuts=function(t){this.useMIRCuts=t},bt.prototype.debug=function(t){this.checkForCycles=t},bt.prototype.log=function(t){return this.tableau.log(t)};var xt={CleanObjectiveAttributes:function(t){var e,r,n;if("string"==typeof t.optimize){if(t.constraints[t.optimize]){for(r in e=Math.random(),t.variables)t.variables[r][t.optimize]&&(t.variables[r][e]=t.variables[r][t.optimize]);return t.constraints[e]=t.constraints[t.optimize],delete t.constraints[t.optimize],t}return t}for(n in t.optimize)if(t.constraints[n])if("equal"===t.constraints[n])delete t.optimize[n];else{for(r in e=Math.random(),t.variables)t.variables[r][n]&&(t.variables[r][e]=t.variables[r][n]);t.constraints[e]=t.constraints[n],delete t.constraints[n]}return t}};var It=function(t){return t.length?function(t){var e={is_blank:/^\W{0,}$/,is_objective:/(max|min)(imize){0,}\:/i,is_int:/^(?!\/\*)\W{0,}int/i,is_bin:/^(?!\/\*)\W{0,}bin/i,is_constraint:/(\>|\<){0,}\=/i,is_unrestricted:/^\S{0,}unrestricted/i,parse_lhs:/(\-|\+){0,1}\s{0,1}\d{0,}\.{0,}\d{0,}\s{0,}[A-Za-z]\S{0,}/gi,parse_rhs:/(\-|\+){0,1}\d{1,}\.{0,}\d{0,}\W{0,}\;{0,1}$/i,parse_dir:/(\>|\<){0,}\=/gi,parse_int:/[^\s|^\,]+/gi,parse_bin:/[^\s|^\,]+/gi,get_num:/(\-|\+){0,1}(\W|^)\d+\.{0,1}\d{0,}/g,get_word:/[A-Za-z].*/},r={opType:"",optimize:"_obj",constraints:{},variables:{}},n={">=":"min","<=":"max","=":"equal"},i="",o=null,s="",a="",h="",c=0;"string"==typeof t&&(t=t.split("\n"));for(var l=0;l<t.length;l++)if(h="__"+l,i=t[l],o=null,e.is_objective.test(i))r.opType=i.match(/(max|min)/gi)[0],(o=i.match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")})).slice(1)).forEach((function(t){s=null===(s=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:s[0],s=parseFloat(s),a=t.match(e.get_word)[0].replace(/\;$/,""),r.variables[a]=r.variables[a]||{},r.variables[a]._obj=s}));else if(e.is_int.test(i))o=i.match(e.parse_int).slice(1),r.ints=r.ints||{},o.forEach((function(t){t=t.replace(";",""),r.ints[t]=1}));else if(e.is_bin.test(i))o=i.match(e.parse_bin).slice(1),r.binaries=r.binaries||{},o.forEach((function(t){t=t.replace(";",""),r.binaries[t]=1}));else if(e.is_constraint.test(i)){var u=i.indexOf(":");(o=(-1===u?i:i.slice(u+1)).match(e.parse_lhs).map((function(t){return t.replace(/\s+/,"")}))).forEach((function(t){s=null===(s=t.match(e.get_num))?"-"===t.substr(0,1)?-1:1:s[0],s=parseFloat(s),a=t.match(e.get_word)[0],r.variables[a]=r.variables[a]||{},r.variables[a][h]=s})),c=parseFloat(i.match(e.parse_rhs)[0]),i=n[i.match(e.parse_dir)[0]],r.constraints[h]=r.constraints[h]||{},r.constraints[h][i]=c}else e.is_unrestricted.test(i)&&(o=i.match(e.parse_int).slice(1),r.unrestricted=r.unrestricted||{},o.forEach((function(t){t=t.replace(";",""),r.unrestricted[t]=1})));return r}(t):function(t){if(!t)throw new Error("Solver requires a model to operate on");var e="",r={max:"<=",min:">=",equal:"="},n=new RegExp("[^A-Za-z0-9_[{}/.&#$%~'@^]","gi");if(t.opType)for(var i in e+=t.opType+":",t.variables)t.variables[i][i]=t.variables[i][i]?t.variables[i][i]:1,t.variables[i][t.optimize]&&(e+=" "+t.variables[i][t.optimize]+" "+i.replace(n,"_"));else e+="max:";for(var o in e+=";\n\n",t.constraints)for(var s in t.constraints[o])if(void 0!==r[s]){for(var a in t.variables)void 0!==t.variables[a][o]&&(e+=" "+t.variables[a][o]+" "+a.replace(n,"_"));e+=" "+r[s]+" "+t.constraints[o][s],e+=";\n"}if(t.ints)for(var h in e+="\n\n",t.ints)e+="int "+h.replace(n,"_")+";\n";if(t.unrestricted)for(var c in e+="\n\n",t.unrestricted)e+="unrestricted "+c.replace(n,"_")+";\n";return e}(t)};function Ct(t){return t=(t=(t=t.replace("\\r\\n","\r\n")).split("\r\n")).filter((function(t){return!0!==new RegExp(" 0$","gi").test(t)&&!1!==new RegExp("\\d$","gi").test(t)})).map((function(t){return t.split(/\:{0,1} +(?=\d)/)})).reduce((function(t,e,r){return t[e[0]]=e[1],t}),{})}var Et={lpsolve:{reformat:It,solve:function(t){return new Promise((function(e,r){"undefined"!=typeof window&&r("Function Not Available in Browser");var n=It(t);t.external||r("Data for this function must be contained in the 'external' attribute. Not seeing anything there."),t.external.binPath||r("No Executable | Binary path provided in arguments as 'binPath'"),t.external.args||r("No arguments array for cli | bash provided on 'args' attribute"),t.external.tempName||r("No 'tempName' given. This is necessary to produce a staging file for the solver to operate on"),i.default.writeFile(t.external.tempName,n,(function(n,i){if(n)r(n);else{var s=o.default.execFile;t.external.args.push(t.external.tempName),s(t.external.binPath,t.external.args,(function(t,n){if(t)if(1===t.code)e(Ct(n));else{var i={code:t.code,meaning:{"-2":"Out of Memory",1:"SUBOPTIMAL",2:"INFEASIBLE",3:"UNBOUNDED",4:"DEGENERATE",5:"NUMFAILURE",6:"USER-ABORT",7:"TIMEOUT",9:"PRESOLVED",25:"ACCURACY ERROR",255:"FILE-ERROR"}[t.code],data:n};r(i)}else e(Ct(n))}))}}))}))}}},Ot=function(t,e){var r,n,i,o,s,a=e.optimize,h=JSON.parse(JSON.stringify(e.optimize)),c=Object.keys(e.optimize),l=0,u={},f="",d={},p=[];for(delete e.optimize,n=0;n<c.length;n++)h[c[n]]=0;for(n=0;n<c.length;n++){for(s in e.optimize=c[n],e.opType=a[c[n]],r=t.Solve(e,void 0,void 0,!0),c)if(!e.variables[c[s]])for(o in r[c[s]]=r[c[s]]?r[c[s]]:0,e.variables)e.variables[o][c[s]]&&r[o]&&(r[c[s]]+=r[o]*e.variables[o][c[s]]);for(f="base",i=0;i<c.length;i++)r[c[i]]?f+="-"+(1e3*r[c[i]]|0)/1e3:f+="-0";if(!u[f]){for(u[f]=1,l++,i=0;i<c.length;i++)r[c[i]]&&(h[c[i]]+=r[c[i]]);delete r.feasible,delete r.result,p.push(r)}}for(n=0;n<c.length;n++)e.constraints[c[n]]={equal:h[c[n]]/l};for(n in e.optimize="cheater-"+Math.random(),e.opType="max",e.variables)e.variables[n].cheater=1;for(n in p)for(o in p[n])d[o]=d[o]||{min:1e99,max:-1e99};for(n in d)for(o in p)p[o][n]?(p[o][n]>d[n].max&&(d[n].max=p[o][n]),p[o][n]<d[n].min&&(d[n].min=p[o][n])):(p[o][n]=0,d[n].min=0);return{midpoint:r=t.Solve(e,void 0,void 0,!0),vertices:p,ranges:d}},Bt=at.Constraint,Mt=at.Variable,jt=at.Numeral,Vt=at.Term,$t=function(){this.Model=yt,this.branchAndCut=pt,this.Constraint=Bt,this.Variable=Mt,this.Numeral=jt,this.Term=Vt,this.Tableau=lt,this.lastSolvedModel=null,this.External=Et,this.Solve=function(t,e,r,n){if(n)for(var i in xt)t=xt[i](t);if(!t)throw new Error("Solver requires a model to operate on");if("object"==typeof t.optimize&&Object.keys(t.optimize>1))return Ot(this,t);if(t.external){var o=Object.keys(Et);if(o=JSON.stringify(o),!t.external.solver)throw new Error("The model you provided has an 'external' object that doesn't have a solver attribute. Use one of the following:"+o);if(!Et[t.external.solver])throw new Error("No support (yet) for "+t.external.solver+". Please use one of these instead:"+o);return Et[t.external.solver].solve(t)}t instanceof yt==!1&&(t=new yt(e).loadJson(t));var s=t.solve();if(this.lastSolvedModel=t,s.solutionSet=s.generateSolutionSet(),r)return s;var a={};return a.feasible=s.feasible,a.result=s.evaluation,a.bounded=s.bounded,s._tableau.__isIntegral&&(a.isIntegral=!0),Object.keys(s.solutionSet).forEach((function(t){0!==s.solutionSet[t]&&(a[t]=s.solutionSet[t])})),a},this.ReformatLP=It,this.MultiObjective=function(t){return Ot(this,t)}};"object"==typeof window?window.solver=new $t:"object"==typeof self&&(self.solver=new $t);var zt=new $t;function kt(t){const e=t.debug?"":"\0",r=t.debug?"rank: ":"\0",n=t.debug?" -> ":"\0";function i(t){return`${e}${t.id}`}function o(t){return`${t.source.id}${n}${t.target.id}`}function s(t,e){return`${r}${t.id}${n}${e.id}`}function a(e){const r=Object.create(null),n=Object.create(null),a=Object.create(null),h=[];for(const o of e){const e=i(o);n[e]=1,r[e]={opt:o.children.length};const s=t.rank(o);void 0!==s&&h.push([s,o])}for(const t of e.ilinks()){const e=r[i(t.source)],n=r[i(t.target)],s=o(t);a[s]={min:1},e[s]=-1,e.opt++,n[s]=1,n.opt--}let[c,...l]=h.sort((([t],[e])=>t-e));for(const t of l){const[e,n]=c,[o,h]=t,l=r[i(n)],u=r[i(h)],f=s(n,h);if(e<o)a[f]={min:1},l[f]=-1,u[f]=1;else{const t=s(h,n);a[f]={min:0},a[t]={min:0},l[f]=-1,l[t]=1,u[f]=1,u[t]=-1}c=t}const u=zt.Solve({optimize:"opt",opType:"max",constraints:a,variables:r,ints:n}),{feasible:f}=u,d=j(u,["feasible"]);if(!f)throw h.length?new Error("could not find a feasbile simplex layout, check that rank accessors are not ill-defined"):new Error("could not find feasbile simplex layout, this should not happen");for(const t of e)t.layer=d[i(t)]||0}return a.rank=function(e){if(void 0===e)return t.rank;{const r=j(t,["rank"]);return kt(Object.assign(Object.assign({},r),{rank:e}))}},a.debug=function(e){return void 0===e?t.debug:kt(Object.assign(Object.assign({},t),{debug:e}))},a}function Tt(){}function St(...t){if(t.length)throw new Error(`got arguments to simplex(${t}), but constructor takes no aruguments.`);return kt({rank:Tt,debug:!1})}function _t(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Rt(t,e){let r;if(void 0===e)for(const e of t)null!=e&&(r<e||void 0===r&&e>=e)&&(r=e);else{let n=-1;for(let i of t)null!=(i=e(i,++n,t))&&(r<i||void 0===r&&i>=i)&&(r=i)}return r}function Nt(t,e){let r;if(void 0===e)for(const e of t)null!=e&&(r>e||void 0===r&&e>=e)&&(r=e);else{let n=-1;for(let i of t)null!=(i=e(i,++n,t))&&(r>i||void 0===r&&i>=i)&&(r=i)}return r}function Pt(t,e,r=0,n=t.length-1,i=_t){for(;n>r;){if(n-r>600){const o=n-r+1,s=e-r+1,a=Math.log(o),h=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*h*(o-h)/o)*(s-o/2<0?-1:1);Pt(t,e,Math.max(r,Math.floor(e-s*h/o+c)),Math.min(n,Math.floor(e+(o-s)*h/o+c)),i)}const o=t[e];let s=r,a=n;for(At(t,r,e),i(t[n],o)>0&&At(t,r,n);s<a;){for(At(t,s,a),++s,--a;i(t[s],o)<0;)++s;for(;i(t[a],o)>0;)--a}0===i(t[r],o)?At(t,r,a):(++a,At(t,a,n)),a<=e&&(r=a+1),e<=a&&(n=a-1)}return t}function At(t,e,r){const n=t[e];t[e]=t[r],t[r]=n}function Dt(t,e,r){if(n=(t=Float64Array.from(function*(t,e){if(void 0===e)for(let e of t)null!=e&&(e=+e)>=e&&(yield e);else{let r=-1;for(let n of t)null!=(n=e(n,++r,t))&&(n=+n)>=n&&(yield n)}}(t,r))).length){if((e=+e)<=0||n<2)return Nt(t);if(e>=1)return Rt(t);var n,i=(n-1)*e,o=Math.floor(i),s=Rt(Pt(t,o).subarray(0,o+1));return s+(Nt(t.subarray(o+1))-s)*(i-o)}}function qt(...t){if(t.length)throw new Error(`got arguments to median(${t}), but constructor takes no aruguments.`);return function(t,e){const r=new l;for(const[e,n]of t.entries())for(const t of n.ichildren())r.setIfAbsent(t.id,[]).push(e);const n=new l;let i=-1;for(const o of e){const e=Dt(r.getDefault(o.id,[]),.5,void 0);void 0===e?(n.set(o.id,i),i=+!((i+1)/(t.length+1))*(t.length+1)-1):n.set(o.id,e)}e.sort(((t,e)=>n.getThrow(t.id)-n.getThrow(e.id)))}}function Ft(t){function e(e){e.slice(0,e.length-1).forEach(((r,n)=>t.order(r,e[n+1])))}return e.order=function(e){if(void 0===e)return t.order;{const r=e,n=j(t,["order"]);return Ft(Object.assign(Object.assign({},n),{order:r}))}},e}function Lt(...t){if(t.length)throw new Error(`got arguments to twoLayer(${t}), but constructor takes no aruguments.`);return Ft({order:qt()})}function Ut(t){function e(e){t.layering(e);for(const t of e){const e=t.layer;if(void 0===e)throw new Error(`layering did not assign layer to node '${t.id}'`);if(e<0)throw new Error(`layering assigned a negative layer (${e}) to node '${t.id}'`)}const r=function(e){const r=[];for(const n of e.descendants()){const e=n.layer;(r[e]||(r[e]=[])).push(n),n.dataChildren=n.dataChildren.map((i=>{const o=i.child.layer;if(o<=e)throw new Error(`layering left child node "${i.child.id}" (${o}) with a greater or equal layer to parent node "${n.id}" (${e})`);let s=i.child;for(let a=o-1;a>e;a--){let e;e=t.debug?`${n.id}->${i.child.id} (${a})`:`${n.id}\0${i.child.id}\0${a}`;const o=new L(e);o.dataChildren.push(new u(s,void 0)),(r[a]||(r[a]=[])).push(o),s=o}return new u(s,i.data)}))}return r}(e),n=function(t){const e=new Map;return function(r){let n=e.get(r.id);if(void 0===n){n=t(r);const[i,o]=n;if(i<0||o<0)throw new Error(`all node sizes must be non-negative, but got width ${i} and height ${o} for node id: ${r.id}`);e.set(r.id,n)}return n}}(t.nodeSize);let i=0;for(const t of r){const e=Math.max(...t.map((t=>n(t)[1])));for(const r of t)r.y=i+e/2;i+=e}if(i<=0)throw new Error("at least one node must have positive height, but total height was zero");t.decross(r);let o=t.coord(r,n);for(const t of r)for(const e of t){if(void 0===e.x)throw new Error(`coord didn't assign an x to node '${e.id}'`);if(e.x<0||e.x>o)throw new Error(`coord assgined an x (${e.x}) outside of [0, ${o}]`)}const s=r;if(null!==t.size){const[e,r]=t.size;for(const t of s)for(const n of t)n.x*=e/o,n.y*=r/i;o=e,i=r}const a=e;return function(t){for(const e of t)e instanceof L||(e.dataChildren=e.dataChildren.map((t=>{let r=t.child;const n=[{x:e.x,y:e.y}];for(;r instanceof L;)n.push({x:r.x,y:r.y}),[r]=r.ichildren();return n.push({x:r.x,y:r.y}),new u(r,t.data,n)})))}(a),{dag:a,width:o,height:i}}return e.layering=function(e){if(void 0===e)return t.layering;{const r=j(t,["layering"]);return Ut(Object.assign(Object.assign({},r),{layering:e}))}},e.decross=function(e){if(void 0===e)return t.decross;{const r=j(t,["decross"]);return Ut(Object.assign(Object.assign({},r),{decross:e}))}},e.coord=function(e){if(void 0===e)return t.coord;{const r=j(t,["coord"]);return Ut(Object.assign(Object.assign({},r),{coord:e}))}},e.size=function(e){return void 0!==e?Ut(Object.assign(Object.assign({},t),{size:e})):t.size},e.nodeSize=function(e){if(void 0!==e){const r=j(t,["nodeSize"]);return Ut(Object.assign(Object.assign({},r),{nodeSize:e}))}return t.nodeSize},e.debug=function(e){return void 0===e?t.debug:Ut(Object.assign(Object.assign({},t),{debug:e}))},e}function Ht(t){const e=+!(t instanceof L);return[e,e]}function Wt(t){function e(e){if(t.topDown)for(const t of e.depth())t.layer=t.value;else!function(t){const e=Math.max(...t.iroots().map((t=>t.value)));for(const r of t)r.layer=e-r.value}(e.height())}return e.topDown=function(e){return void 0===e?t.topDown:Wt(Object.assign(Object.assign({},t),{topDown:e}))},e}function Gt(...t){if(t.length)throw new Error(`got arguments to longestPath(${t}), but constructor takes no aruguments.`);return Wt({topDown:!0})}var Jt=function(t,e){return t<e};function Zt(t){if(!(this instanceof Zt))return new Zt(t);this.array=[],this.size=0,this.compare=t||Jt}Zt.prototype.clone=function(){var t=new Zt(this.compare);t.size=this.size;for(var e=0;e<this.size;e++)t.array.push(this.array[e]);return t},Zt.prototype.add=function(t){var e,r,n=this.size;for(this.array[this.size]=t,this.size+=1;n>0&&(e=n-1>>1,r=this.array[e],this.compare(t,r));)this.array[n]=r,n=e;this.array[n]=t},Zt.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},Zt.prototype._percolateUp=function(t,e){for(var r,n,i=this.array[t];t>0&&(r=t-1>>1,n=this.array[r],e||this.compare(i,n));)this.array[t]=n,t=r;this.array[t]=i},Zt.prototype._percolateDown=function(t){for(var e,r,n,i=this.size,o=this.size>>>1,s=this.array[t];t<o&&(r=(e=1+(t<<1))+1,n=this.array[e],r<i&&this.compare(this.array[r],n)&&(e=r,n=this.array[r]),this.compare(n,s));)this.array[t]=n,t=e;this.array[t]=s},Zt.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},Zt.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},Zt.prototype._batchRemove=function(t,e){var r=new Array(e||this.size),n=0;if("function"==typeof t&&this.size)for(var i=0;i<this.size&&n<r.length;)t(this.array[i])?(r[n]=this._removeAt(i),n++,i>>=1):i++;return r.length=n,r},Zt.prototype.removeOne=function(t){var e=this._batchRemove(t,1);return e.length>0?e[0]:void 0},Zt.prototype.removeMany=function(t,e){return this._batchRemove(t,e)},Zt.prototype.peek=function(){if(0!=this.size)return this.array[0]},Zt.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},Zt.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},Zt.prototype.trim=function(){this.array=this.array.slice(0,this.size)},Zt.prototype.isEmpty=function(){return 0===this.size},Zt.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,r=this.clone();!r.isEmpty();)t(r.poll(),e++)},Zt.prototype.kSmallest=function(t){if(0==this.size)return[];var e=this.compare,r=this.array,n=new Zt((function(t,n){return e(r[t],r[n])}));t=Math.min(this.size,t);var i=new Array(t),o=0;for(n.add(0);o<t;){var s=n.poll();i[o++]=this.array[s];var a=1+(s<<1),h=a+1;a<this.size&&n.add(a),h<this.size&&n.add(h)}return i};var Qt=Zt;class Yt{constructor(){this.before=[],this.parents=[]}}function Kt(t){function e(e){const r=t.width||Math.floor(Math.sqrt(e.size()+.5)),n=new l(e.idescendants().map((t=>[t.id,new Yt])));for(const t of e)for(const e of t.ichildren())n.getThrow(e.id).parents.push(t);const i=new Qt((function(t,e){const r=n.getThrow(t.id).before,i=n.getThrow(e.id).before;for(const[t,e]of r.entries()){const r=i[t];if(void 0===r)return!1;if(e<r)return!0;if(r<e)return!1}return!0}));for(const t of e.iroots())i.add(t);let o,s=0,a=0,c=0;for(;o=i.poll();){c<r&&n.getThrow(o.id).parents.every((t=>h(t.layer)<a))?(o.layer=a,c++):(o.layer=++a,c=1);for(const t of o.ichildren()){const{before:e,parents:r}=n.getThrow(t.id);e.push(s),e.length===r.length&&(e.sort(((t,e)=>e-t)),i.add(t))}s++}}return e.width=function(e){if(void 0===e)return t.width;if(e<0)throw new Error(`width must be non-negative: ${e}`);return Kt(Object.assign(Object.assign({},t),{width:e}))},e}function Xt(t){const e=t.debug?" => ":"\0\0",r=t.debug?" ":"\0\0\0";function n(...t){return t.map((t=>t.id)).sort().join(e)}function i(t,e){e.sort(((t,e)=>+(t.id>e.id)||-1));for(const[r,i]of e.slice(0,e.length-1).entries())for(const o of e.slice(r+1)){const e=n(i,o);t.ints[e]=1,t.constraints[e]=Object.assign(Object.create(null),{max:1}),t.variables[e]=Object.assign(Object.create(null),{opt:0,[e]:1})}for(const[r,i]of e.slice(0,e.length-1).entries())for(const[o,s]of e.slice(r+1).entries())for(const a of e.slice(r+o+2)){const e=n(i,s),r=n(i,a),o=n(s,a),h=n(i,s,a),c=h+"+";t.constraints[c]=Object.assign(Object.create(null),{max:1}),t.variables[e][c]=1,t.variables[r][c]=-1,t.variables[o][c]=1;const l=h+"-";t.constraints[l]=Object.assign(Object.create(null),{min:0}),t.variables[e][l]=1,t.variables[r][l]=-1,t.variables[o][l]=1}}function o(e,i){for(const[o,s]of i.slice(0,i.length-1).entries())for(const a of i.slice(o+1)){const i=n(s,a);for(const o of s.ichildren())for(const s of a.ichildren()){if(o===s)continue;const a=n(o,s),h=t.debug?`slack (${i}) (${a})`:`${i}\0\0\0${a}`,c=`${h}${r}+`,l=`${h}${r}-`;e.variables[h]=Object.assign(Object.create(null),{opt:1,[c]:1,[l]:1});const u=+(o.id>s.id),f=u||-1;e.constraints[c]=Object.assign(Object.create(null),{min:u}),e.variables[i][c]=1,e.variables[a][c]=f,e.constraints[l]=Object.assign(Object.create(null),{min:-u}),e.variables[i][l]=-1,e.variables[a][l]=-f}}}function s(e){if(!t.clowntown&&e.reduce(((t,e)=>t+e.length*e.length),0)>2500)throw new Error("size of dag to decrossOpt is too large and will likely crash not complete, enable clowntown to run anyway");const r={optimize:"opt",opType:"min",constraints:Object.create(null),variables:Object.create(null),ints:Object.create(null)};for(const t of e)i(r,t);for(const t of e.slice(0,e.length-1))o(r,t);const s=zt.Solve(r);for(const t of e)t.sort(((t,e)=>(+(t.id>e.id)||-1)*(s[n(t,e)]||-1)))}return s.debug=function(e){return void 0===e?t.debug:Xt(Object.assign(Object.assign({},t),{debug:e}))},s.clowntown=function(e){return void 0===e?t.clowntown:Xt(Object.assign(Object.assign({},t),{clowntown:e}))},s}function te(t){function e(e,r){const{weight:n}=t;return H().vertical([(1-n)/2,(1-n)/2]).curve([n,n]).component(.5)(e,r)}return e.weight=function(e){if(void 0===e)return t.weight;if(e<0||e>=1)throw new Error(`weight must be in [0, 1), but was ${e}`);return te(Object.assign(Object.assign({},t),{weight:e}))},e}function ee(t,e){for(const t of e)t.x=0;const r=new l;for(const e of t)for(const t of e.ichildren()){if(void 0===t.x)throw new Error(`unexpected undefined x for '${t.id}'`);const n=r.getDefault(t.id,0)+1;r.set(t.id,n),t.x+=(h(e.x)-t.x)/n}}class re{constructor(){this.mean=0,this.count=0}add(t){this.mean+=(t-this.mean)/++this.count}}function ne(t){const e=t.debug?" => ":"\0\0";function r(...t){return t.map((t=>t.id)).sort().join(e)}function n(e,n){if(!t.clowntown&&n.length>50)throw new Error("bottomLayer to twolayerOpt is too large and will likely crash, enable clowntown to run anyway");const i={optimize:"opt",opType:"min",constraints:Object.create(null),variables:Object.create(null),ints:Object.create(null)};n.sort(((t,e)=>+(t.id>e.id)||-1));for(const[t,e]of n.slice(0,n.length-1).entries())for(const o of n.slice(t+1)){const t=r(e,o);i.ints[t]=1,i.constraints[t]=Object.assign(Object.create(null),{max:1}),i.variables[t]=Object.assign(Object.create(null),{opt:0,[t]:1})}for(const[t,e]of n.slice(0,n.length-1).entries())for(const[o,s]of n.slice(t+1).entries())for(const a of n.slice(t+o+2)){const t=r(e,s),n=r(e,a),o=r(s,a),h=r(e,s,a),c=h+"+";i.constraints[c]=Object.assign(Object.create(null),{max:1}),i.variables[t][c]=1,i.variables[n][c]=-1,i.variables[o][c]=1;const l=h+"-";i.constraints[l]=Object.assign(Object.create(null),{min:0}),i.variables[t][l]=1,i.variables[n][l]=-1,i.variables[o][l]=1}for(const[t,n]of e.slice(0,e.length-1).entries())for(const o of e.slice(t+1))for(const t of n.ichildren())for(const e of o.ichildren()){if(t===e)continue;const n=r(t,e);i.variables[n].opt+=+(t.id>e.id)||-1}const o=zt.Solve(i);n.sort(((t,e)=>(+(t.id>e.id)||-1)*(+o[r(t,e)]||-1)))}return n.debug=function(e){return void 0===e?t.debug:ne(Object.assign(Object.assign({},t),{debug:e}))},n.clowntown=function(e){return void 0===e?t.clowntown:ne(Object.assign(Object.assign({},t),{clowntown:e}))},n}function ie(t,e){const r=t.findIndex((t=>t<=e));return r>=0?r:t.length}function oe(t,e){function r(r){const n=function(t){const e=[...t.idescendants("before")];for(const[t,r]of e.entries())r.layer=t;return e}(r),i=n.length-1;if(0===i){const[r]=n;r.x=t/2,r.y=e/2}else{!function(r,n,i){let o=0,s=0;for(const{source:t,target:e}of r.ilinks())if(e.layer>t.layer+1){const r=n.get(`${t.id}\0${e.id}`);if(void 0===r)throw new Error(`indexer didn't index ${t.id} -> ${e.id}`);o=Math.min(o,r),s=Math.max(s,r)}o===s&&(o=-1,s=1);for(const n of r)n.x=-o/(s-o)*t,n.y=n.layer/i*e;!function(r,n,i,o,s){for(const{source:a,target:h,points:c}of r.ilinks()){if(c.length=0,c.push({x:a.x,y:a.y}),h.layer-a.layer>1){const r=n.get(`${a.id}\0${h.id}`);if(void 0===r)throw new Error(`indexer didn't index ${a.id} -> ${h.id}`);const l=(r-o)/(s-o)*t,u=(a.layer+1)/i*e,f=(h.layer-1)/i*e;h.layer-a.layer>2?c.push({x:l,y:u},{x:l,y:f}):c.push({x:l,y:u})}c.push({x:h.x,y:h.y})}}(r,n,i,o,s)}(r,function(t){const e=new Map,r=[],n=[];for(const i of t)for(const t of i.children().sort(((t,e)=>t.layer-e.layer))){const o=`${i.id}\0${t.id}`;if(t.layer>i.layer+1){const s=ie(n,i.layer),a=ie(r,i.layer);s<a?(e.set(o,-s-1),n[s]=t.layer-1):(e.set(o,a+1),r[a]=t.layer-1)}}return e}(n),i)}return r}return r.size=function(r){if(void 0===r)return[t,e];{const[t,e]=r;return oe(t,e)}},r}function se(t){function e(e){const r=new l,n=new l;for(const t of e.slice().reverse())for(const e of t){r.set(e.id,e);let t=0;for(const i of e.ichildren())r.delete(i.id),t+=n.getThrow(i.id);n.set(e.id,Math.max(t,1))}let i=0;for(const e of r.values()){const r=n.getThrow(e.id);e.columnIndex=i+(t?Math.floor((r-1)/2):0),o(e,i),i+=r}function o(e,r){let i=r;for(const r of e.ichildren()){if(void 0!==r.columnIndex)return;const e=n.getThrow(r.id);r.columnIndex=i+(t?Math.floor((e-1)/2):0),o(r,i),i+=e}}}return e.center=function(e){return void 0===e?t:se(e)},e}function ae(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);return se(!1)}function he(...t){if(t.length)throw new Error(`got arguments to spread(${t}), but constructor takes no aruguments.`);return function(t,e,r){const n=Math.max(...t.map((t=>Math.max(...t.map((t=>t.columnIndex))))))+1,i=[];for(let t=0;t<n;++t)i.push(e(t));const o=[0];for(let t=0;t<n-1;++t){const e=o[t]+i[t]+r(t);o.push(e)}const s=o[n-1]+i[n-1];for(const e of t)for(const t of e){const e=o[t.columnIndex],r=i[t.columnIndex];t.x0=e/s,t.x1=(e+r)/s}}}class ce extends d{constructor(t){super(t,void 0)}}function le(t,e,r,n,i,o,s,a,h,c,f){function d(d){const p=function(t){const e=new l;for(const r of t.idescendants("after")){const t=Math.max(0,...r.ichildren().map((t=>e.getThrow(t.id))));e.set(r.id,f(r)+t)}return e}(d);n(d);for(const t of d){const e=t.layer;if(void 0===e)throw new Error(`layering did not assign layer to node '${t.id}'`);if(e<0)throw new Error(`layering assigned a negative layer (${e}) to node '${t.id}'`)}const v=function(e){const r=[],n=Math.max(...e.idescendants().map((t=>t.layer)));for(const i of e){const e=i.layer;if((r[e]||(r[e]=[])).push(i),i.dataChildren=i.dataChildren.map((n=>{const o=n.child.layer;if(o<=e)throw new Error(`layering left child node "${n.child.id}" (${o}) with a greater or equal layer to parent node "${i.id}" (${e})`);let s=n.child;for(let a=o-1;a>e;a--){let e;e=t?`${i.id}->${n.child.id} (${a})`:`${i.id}\0${n.child.id}\0${a}`;const o=new ce(e);o.dataChildren.push(new u(s,void 0)),(r[a]||(r[a]=[])).push(o),s=o}return new u(s,n.data)})),0===i.dataChildren.length&&e<n){let e=new ce(t?`${i.id} (${n})`:`${i.id}\0${n}`);(r[n]||(r[n]=[])).push(e);for(let o=n-1;o>i.layer;o--){const s=new ce(t?`${i.id} (${n})`:`${i.id}\0${n}`);s.dataChildren.push(new u(e,void 0)),(r[o]||(r[o]=[])).push(s),e=s}i.dataChildren=[new u(e,void 0)]}}return r}(d);let g;if(1===v.length){const[t]=v;for(const e of t)e.y0=0,e.y1=1;g=1}else{const t=function(t){const e=new l;for(const r of t.idescendants("before")){const t=e.getDefault(r.id,0)+f(r);e.set(r.id,t);for(const n of r.ichildren()){const r=Math.max(t,e.getDefault(n.id,0));e.set(n.id,r)}}return e}(d);let e=v[0];const r=Math.max(...e.map((t=>p.getThrow(t.id))));for(const r of e){const e=r.y1=t.getThrow(r.id);r.y0=e-f(r)}g=0;for(const[r,n]of v.slice(1).entries()){g+=a(e,n,r);for(const e of n){const r=e.y1=g+t.getThrow(e.id);e.y0=r-f(e)}e=n}g+=r}i(v),o(v);for(const t of v)for(const e of t){if(void 0===e.columnIndex)throw new Error(`column did not assign an index to node '${e.id}'`);if(e.columnIndex<0)throw new Error(`column assigned a negative index (${e.columnIndex}) to node '${e.id}'`)}s(v,h,c);for(const t of v)for(const e of t){if(void 0===e.x0||void 0===e.x1)throw new Error(`coord did not assign both x coordinates to node '${e.id}'`);if(e.x0>e.x1)throw new Error(`coord did not assign valid x coordinates to node '${e.id}'`)}const m=d;return function(t,n){for(const i of t)i.x0*=e,i.x1*=e,i.y0*=r/n,i.y1*=r/n}(m,g),function(t){for(const e of t)if(!(e instanceof ce)){const t=[];for(const r of e.dataChildren){let n=r.child;const i=[{x:(e.x0+e.x1)/2,y:e.y1}];for(;void 0!==n&&n instanceof ce;)i.push({x:(n.x0+n.x1)/2,y:n.y0}),[n]=n.ichildren();if(void 0!==n){i.push({x:(n.x0+n.x1)/2,y:n.y0});const e=new u(n,r.data,i);t.push(e)}}e.dataChildren=t}}(m),m}return d.size=function(l){if(void 0===l)return[e,r];{const[e,r]=l;return le(t,e,r,n,i,o,s,a,h,c,f)}},d.layering=function(l){return void 0===l?n:le(t,e,r,l,i,o,s,a,h,c,f)},d.decross=function(l){return void 0===l?i:le(t,e,r,n,l,o,s,a,h,c,f)},d.column=function(l){return void 0===l?o:le(t,e,r,n,i,l,s,a,h,c,f)},d.coord=function(l){return void 0===l?s:le(t,e,r,n,i,o,l,a,h,c,f)},d.layerSeparation=function(l){return void 0===l?a:le(t,e,r,n,i,o,s,l,h,c,f)},d.columnWidth=function(l){return void 0===l?h:le(t,e,r,n,i,o,s,a,l,c,f)},d.columnSeparation=function(l){return void 0===l?c:le(t,e,r,n,i,o,s,a,h,l,f)},d}function ue(){return 1}function fe(){return 10}function de(){return 1}function pe(t){if(t instanceof ce)return 0;if(function(t){const e=t.heightRatio;return void 0===e||"number"==typeof e}(t))return t.heightRatio||0;throw new Error("default height ratio expects node with heightRatio property but got nothing")}function ve(t){function e(e){const r=new l;for(const t of e)for(const e of t)for(const t of e.ichildren())r.setIfAbsent(t.id,[]).push(e);const n=Math.max(...e.map((t=>t.length))),i=e.findIndex((t=>t.length===n));for(const[t,r]of e[i].entries())r.columnIndex=t;for(const t of e.slice(0,i).reverse())o(t);for(const t of e.slice(i+1))s(t);function o(e){if(e.length===n)for(const[t,r]of e.entries())r.columnIndex=t;else{const r=a(e.map(((e,r)=>{if(0===e.dataChildren.length)return r;const n=[...e.ichildren().map((t=>h(t.columnIndex)))];return t?n.sort(((t,e)=>t-e))[Math.floor((n.length-1)/2)]:Math.min(...n)})));for(const[t,n]of e.entries())n.columnIndex=r[t]}}function s(e){if(e.length===n)for(const[t,r]of e.entries())r.columnIndex=t;else{const n=a(e.map(((e,n)=>{const i=r.getDefault(e.id,[]);if(0===i.length)return n;const o=i.map((t=>h(t.columnIndex)));return t?o[Math.floor((o.length-1)/2)]:Math.min(...o)})));for(const[t,r]of e.entries())r.columnIndex=n[t]}}function a(t){for(const e of t)if(!isFinite(e))throw new Error("columnComplex: non-finite column index encountered");let e=-1;t=t.map((t=>(t<=e&&(t=e+1),e=t,t)));const r=Math.max(...t)-(n-1);return r>0&&(t=t.map(((t,e)=>Math.max(t-r,e)))),t}}return e.center=function(e){return void 0===e?t:ve(e)},e}t.ArqDummyNode=ce,t.SugiDummyNode=L,t.arqcoordSpread=he,t.arquint=function(){return le(!1,1,1,Gt().topDown(!1),Lt(),ae(),he(),ue,fe,de,pe)},t.columnAdjacent=function(...t){if(t.length)throw new Error(`got arguments to adjacent(${t}), but constructor takes no aruguments.`);return ve(!1)},t.columnCenter=function(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);return function(t){const e=Math.max(...t.map((t=>t.length)));for(const r of t){const t=Math.floor((e-r.length)/2);for(const[e,n]of r.entries())n.columnIndex=t+e}}},t.columnComplex=ae,t.columnLeft=function(...t){if(t.length)throw new Error(`got arguments to left(${t}), but constructor takes no aruguments.`);return function(t){for(const e of t)for(const[t,r]of e.entries())r.columnIndex=t}},t.coordCenter=function(...t){if(t.length)throw new Error(`got arguments to center(${t}), but constructor takes no aruguments.`);return function(t,e){const r=t.map((t=>{let r=0;for(const n of t){const t=e(n)[0];n.x=r+t/2,r+=t}return r})),n=Math.max(...r);if(n<=0)throw new Error("must assign nonzero width to at least one node");for(const[e,i]of t.entries()){const t=(n-r[e])/2;for(const e of i)e.x=h(e.x)+t}return n}},t.coordGreedy=function(...t){if(t.length)throw new Error(`got arguments to greedy(${t}), but constructor takes no aruguments.`);return function(t,e){const r=ee,n=new l;for(const e of t)for(const t of e)n.set(t.id,t.ichildren().length+(t instanceof L?-3:0));for(const e of t)for(const t of e)for(const e of t.ichildren())n.set(e.id,n.getThrow(e.id)+1);let[i,...o]=t,s=0,a=0;for(const t of i){const r=e(t)[0];t.x=a+r/2,a+=r}for(const t of o){r(i,t);const o=t.map(((t,e)=>[e,t])).sort((([t,e],[r,i])=>{const o=n.getThrow(e.id),s=n.getThrow(i.id);return o===s?t-r:s-o}));for(const[r,n]of o){const i=e(n)[0];let o=h(n.x)+i/2;for(const n of t.slice(r+1)){const t=e(n)[0]/2;o=(n.x=Math.max(h(n.x),o+t))+t}a=Math.max(a,o);let c=h(n.x)-i/2;for(const n of t.slice(0,r).reverse()){const t=e(n)[0]/2;c=(n.x=Math.min(h(n.x),c-t))-t}s=Math.min(s,c)}i=t}for(const e of t)for(const t of e)t.x=h(t.x)-s;const c=a-s;if(c<=0)throw new Error("must assign nonzero width to at least one node");return c}},t.coordMinCurve=function(...t){if(t.length)throw new Error(`got arguments to minCurve(${t}), but constructor takes no aruguments.`);return te({weight:.5})},t.coordQuad=H,t.coordTopological=function(...t){if(t.length)throw new Error(`got arguments to topological(${t}), but constructor takes no aruguments.`);return function(t,e){for(const e of t){if(1!==e.reduce(((t,e)=>t+ +!(e instanceof L)),0))throw new Error("topological() only works with a topological layering")}const r=new l;let n=0;for(const e of t)for(const t of e)t instanceof L&&r.set(t.id,n++);for(const e of t)for(const t of e)t instanceof L||r.set(t.id,n);const[i,o,s,a]=A(t,r,e);for(const e of t)for(const t of e){const e=r.getThrow(t.id);for(const n of t.ichildren()){const t=r.getThrow(n.id);if(n instanceof L)for(const o of n.ichildren()){q(i,e,t,r.getThrow(o.id),1)}}}const h=F(t,e,r,P(i,o,s,a));if(h<=0)throw new Error("must assign nonzero width to at least one node");return h}},t.coordVert=H,t.dagConnect=function(...t){if(t.length)throw new Error(`got arguments to dagConnect(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagConnect()(...)`);return x(I,C)},t.dagHierarchy=function(...t){if(t.length)throw Error(`got arguments to dagHierarchy(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagHierarchy()(...)`);return E(B,M,O(M))},t.dagStratify=function(...t){if(t.length)throw Error(`got arguments to dagStratify(${t}), but constructor takes no aruguments. These were probably meant as data which should be called as dagStratify()(...)`);return m(b,y,w(y))},t.decrossOpt=function(...t){if(t.length)throw new Error(`got arguments to opt(${t}), but constructor takes no aruguments.`);return Xt({debug:!1,clowntown:!1})},t.decrossTwoLayer=Lt,t.layeringCoffmanGraham=function(...t){if(t.length)throw new Error(`got arguments to coffmanGraham(${t}), but constructor takes no aruguments.`);return Kt({width:0})},t.layeringLongestPath=Gt,t.layeringSimplex=St,t.layeringTopological=function(...t){if(t.length)throw new Error(`got arguments to topological(${t}), but constructor takes no aruguments.`);return function(t){for(const[e,r]of t.idescendants("before").entries())r.layer=e}},t.sugiyama=function(...t){if(t.length)throw new Error(`got arguments to sugiyama(${t}), but constructor takes no aruguments.`);return Ut({layering:St(),decross:Lt(),coord:H(),size:null,nodeSize:Ht,debug:!1})},t.twolayerMean=function(...t){if(t.length)throw new Error(`got arguments to mean(${t}), but constructor takes no aruguments.`);return function(t,e){const r=new l(e.map((t=>[t.id,new re])));for(const[e,n]of t.entries())for(const t of n.ichildren())r.getThrow(t.id).add(e);e.sort(((t,e)=>r.getThrow(t.id).mean-r.getThrow(e.id).mean))}},t.twolayerMedian=qt,t.twolayerOpt=function(...t){if(t.length)throw new Error(`got arguments to opt(${t}), but constructor takes no aruguments.`);return ne({debug:!1,clowntown:!1})},t.zherebko=function(...t){if(t.length)throw new Error(`got arguments to zherebko(${t}), but constructor takes no aruguments.`);return oe(1,1)},Object.defineProperty(t,"__esModule",{value:!0})}));
